<!DOCTYPE html>
<html data-n-head="" data-n-head-ssr>
  <head>
    <meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="My stunning Nuxt.js project" name="description" data-hid="description"><title data-n-head="true">nuxt-blog</title><link href="/favicon.ico" rel="icon" data-n-head="true" type="image/x-icon"><base href="/nuxt-blog/"><link href="/nuxt-blog/_nuxt/manifest.99e36d02ae9d35f9a67a.js" rel="preload" as="script"><link href="/nuxt-blog/_nuxt/vendor.99e36d02ae9d.js" rel="preload" as="script"><link href="/nuxt-blog/_nuxt/hare.3ad678fdff0b.js" rel="preload" as="script"><link href="/nuxt-blog/_nuxt/hare.1210ab93f72a.css" rel="preload" as="style"><link href="/nuxt-blog/_nuxt/layouts_default.3e9b7a2d9551da30542e.js" rel="preload" as="script"><link href="/nuxt-blog/_nuxt/pages_index.1a1dabc786aba819b9a7.js" rel="preload" as="script"><link href="/nuxt-blog/_nuxt/pages_topic_index.b0d7cafae26ed5f2ebbe.js" rel="prefetch"><link href="/nuxt-blog/_nuxt/pages_topic_create.ac9ee0c71490d976a9bd.js" rel="prefetch"><link href="/nuxt-blog/_nuxt/pages_my_messages.678e51480df571961479.js" rel="prefetch"><link href="/nuxt-blog/_nuxt/pages_register.7ac68d24410515f9e20e.js" rel="prefetch"><link href="/nuxt-blog/_nuxt/pages_login.56fa4d7a486b0b2280f8.js" rel="prefetch"><link href="/nuxt-blog/_nuxt/hare.1210ab93f72a.css" rel="stylesheet"><style data-vue-ssr-id="b30ab75e:0">html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:14px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}.button--green{display:inline-block;-webkit-border-radius:4px;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;-webkit-border-radius:4px;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}</style><style data-vue-ssr-id="0302a88c:0">.topics-container .header{margin-top:15px;padding:10px;background-color:#f6f6f6;-webkit-border-radius:3px 3px 0 0;border-radius:3px 3px 0 0}.topics-container .header .el-tabs .el-tabs__header{margin:0}</style><style data-vue-ssr-id="fbd963e6:0"></style><style data-vue-ssr-id="03ebe74a:0">#sidebar .box-card[data-v-33b2654c]{margin-bottom:15px}#sidebar .box-card .user_avatar[data-v-33b2654c]{vertical-align:middle;margin-right:10px}#sidebar .box-card .user_avatar img[data-v-33b2654c]{width:48px;height:48px;-webkit-border-radius:3px;border-radius:3px}#sidebar .box-card .user_name[data-v-33b2654c]{font-size:16px;max-width:120px;display:inline-block;vertical-align:middle}#sidebar .box-card .board[data-v-33b2654c]{margin-top:10px;width:80%}#sidebar .box-card .signature[data-v-33b2654c]{font-style:italic;font-size:14px}</style>
  </head>
  <body data-n-head="">
    <div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#3b8070;opacity:0"></div><div id="__layout"><div><section class="topics-container container"><div class="navbar" data-v-86417824><div class="navbar-inner" data-v-86417824><div class="navbar-container" data-v-86417824><ul role="menubar" class="el-menu el-menu--horizontal" data-v-86417824><li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824><a href="/nuxt-blog/" class="nuxt-link-exact-active nuxt-link-active" data-v-86417824>é¦–é¡µ</a><li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824><a href="/nuxt-blog/my/messages" data-v-86417824>æœªè¯»ä¿¡æ¯</a><li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824>æ–°æ‰‹å…¥é—¨<li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824>API<li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824>å…³äº<li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824>è®¾ç½®<li role="menuitem" tabindex="-1" class="el-menu-item" style="border-bottom-color:transparent" data-v-86417824><span data-v-86417824>ç™»å½•</span></ul></div></div></div><div class="clearfix" id="main"><aside id="sidebar" data-v-33b2654c><div class="el-card box-card" data-v-33b2654c><div class="el-card__header"><div class="box-card-header" data-v-33b2654c><span data-v-33b2654c>ä¸ªäººä¿¡æ¯</span></div></div><div class="el-card__body"><div class="box-card-content" data-v-33b2654c><div class="box-card-content-header" data-v-33b2654c><a href="javascript:;" class="user_avatar" data-v-33b2654c><img data-v-33b2654c></a><span class="user_name" data-v-33b2654c></span></div><div class="board" data-v-33b2654c><span data-v-33b2654c>ç§¯åˆ†ï¼š</span></div><div class="bottom" data-v-33b2654c><span class="signature" data-v-33b2654c>â€œ è¿™å®¶ä¼™å¾ˆæ‡’ï¼Œä»€ä¹ˆä¸ªæ€§ç­¾åéƒ½æ²¡æœ‰ç•™ä¸‹ã€‚ â€</span></div></div></div></div><div class="el-card box-card" data-v-33b2654c><!----><div class="el-card__body"><div class="box-card-content" data-v-33b2654c><button class="el-button el-button--success el-button--small" type="button" data-v-33b2654c><!----><!----><span>å‘å¸ƒè¯é¢˜</span></button></div></div></div></aside><div id="content"><header class="header"><div class="el-tabs el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div class="el-tabs__nav" style="transform:translateX(0)" role="tablist"><div class="el-tabs__active-bar is-top"></div></div></div></div></div><div class="el-tabs__content"><div class="el-tab-pane" style="display:none" role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null"></div><div class="el-tab-pane" style="display:none" role="tabpanel" aria-hidden="true" id="pane-good" aria-labelledby="tab-good"></div><div class="el-tab-pane" style="display:none" role="tabpanel" aria-hidden="true" id="pane-share" aria-labelledby="tab-share"></div><div class="el-tab-pane" style="display:none" role="tabpanel" aria-hidden="true" id="pane-ask" aria-labelledby="tab-ask"></div><div class="el-tab-pane" style="display:none" role="tabpanel" aria-hidden="true" id="pane-job" aria-labelledby="tab-job"></div></div></div></header><div class="table-list"><div class="el-table el-table--fit el-table--enable-row-hover el-table--enable-row-transition" style="width:100%"><div class="hidden-columns"><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="el-table__header-wrapper"><table cellspacing="0" cellpadding="0" border="0" class="el-table__header"><colgroup><thead><tr></thead></table></div><div class="el-table__body-wrapper is-scrolling-none"><table cellspacing="0" cellpadding="0" border="0" class="el-table__body"><colgroup><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"><tr class="el-table__row"></tr><!----></table><!----><!----></div><!----><!----><!----><!----><div class="el-table__column-resize-proxy" style="display:none"></div></div><div class="pagination"><div class="el-pagination"><span class="el-pagination__total">å…± 1000 æ¡</span><button class="btn-prev disabled" type="button"><i class="el-icon el-icon-arrow-left"></i></button><ul class="el-pager"><li class="number active">1</li><!----><li class="number">2<li class="number">3<li class="number">4<li class="number">5<li class="number">6<li class="el-icon more btn-quicknext el-icon-more"><li class="number">100</ul><button class="btn-next" type="button"><i class="el-icon el-icon-arrow-right"></i></button><span class="el-pagination__jump">å‰å¾€<div class="el-input el-pagination__editor is-in-pagination" value="1"><!----><input autocomplete="off" autocomplete="off" class="el-input__inner" type="number" rows="2" max="100" min="1" validateevent="true" value="1"><!----><!----><!----></div>é¡µ</span><button class="el-button jump-page-btn el-button--primary el-button--small" type="button"><!----><!----><span>è·³è½¬</span></button></div></div></div></div></div></section></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{}],error:null,state:{topic:{topic:{},loading:!1},topics:{topics:[{id:"5aae1cc8f5dfc27d7ad98909",author_id:"4efc278525fa69ac69000013",tab:"share",content:"> æ›´æ–°ï¼šå…¬æµ‹ç‰ˆæœ¬å·²ç»ä¸Šçº¿ï¼Œè¯·è®¿é—® http://egg.cnodejs.org/ ï¼Œå¦‚é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æäº¤issue https://github.com/cnodejs/egg-cnode/issues ï¼Œè°¢è°¢å„ä½ã€‚\r\n\r\nåœ¨è¿‘æœŸï¼Œç»è¿‡ç¤¾åŒºçš„å°ä¼™ä¼´ä»¬çš„ä¸€èµ·åŠªåŠ›ä¸‹ï¼Œæˆ‘ä»¬åŸºäº Egg.js å°† nodeclub è¿›è¡Œäº†é‡å†™ï¼Œé‡å†™åçš„ä»£ç ä»“åº“ä½äº https://github.com/cnodejs/egg-cnode ã€‚\r\n\r\nåŸç‰ˆçš„ nodeclub æ˜¯ 2012 å¹´å·¦å³ï¼Œåœ¨æ·˜å®å®ä¹ çš„æŸä¸ªåŒå­¦å®ç°çš„ï¼Œå½“æ—¶çš„æƒ…å†µä¸‹ï¼Œå‡ ä¹æ²¡æœ‰å¤šå°‘äººæœ‰è¿‡ Node.js å¼€å‘çœŸå®é¡¹ç›®çš„ç»éªŒï¼Œå› æ­¤ï¼Œè¯¥é¡¹ç›®ä¹Ÿå­˜åœ¨è¯¸å¤šç¨šå«©ä¹‹å¤„ï¼Œæ›¾ç»ä¹Ÿè¢« ITeye çš„å¤§ä½¬æ‰¹åˆ¤è¿‡ã€‚\r\n\r\nåæ¥åœ¨ alsotangã€é¢˜å¶ç­‰äººçš„ç»´æŠ¤ä¸‹ï¼ŒCNode ç»å†è¿‡ä¸€æ¬¡è¾ƒå¤§çš„é‡æ„ï¼Œä½†é‚£æ¬¡é‡æ„æ²¡æœ‰å¯¹åŸæ¥çš„é¡¹ç›®è¿›è¡Œæ ¹æœ¬æ€§çš„æ”¹åŠ¨ï¼Œé‡ç‚¹æ˜¯ç”¨æˆ·ä½“éªŒå±‚é¢çš„æ”¹åŠ¨ã€‚å› æ­¤ nodeclub ä¾ç„¶ä¿æŒç€æ¯”è¾ƒå¤è€çš„æ–¹å¼ï¼Œexpress + ejs + mongoose ç­‰ã€‚åŸé¡¹ç›®ç¼ºä¹ä¸€äº›å·¥ç¨‹æ€§çš„é—®é¢˜ï¼š\r\n\r\n1. åŸºäº Callback å›è°ƒçš„é£æ ¼ï¼Œåœ¨ç»´æŠ¤ä¸Šè¾ƒä¸ºå›°éš¾ã€‚\r\n2. æ²¡æœ‰å¥å£®çš„è¿›ç¨‹å®ˆæŠ¤æœºåˆ¶ï¼Œçº¯ç²¹ä¾é  PM2 ã€‚\r\n3. ç›®å‰è¯¥é¡¹ç›®è¿è¡Œæ—¶ä¹Ÿæ˜¯å•æœºæ¨¡å¼ï¼Œæ²¡æœ‰æ›´å¥½çš„å¯ç”¨æ€§ã€‚\r\n\r\næœ¬æ¬¡æˆ‘ä»¬åŸºäº ES 8ã€Egg æ¡†æ¶ï¼Œåœ¨ä¸æ”¹å†™ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ”¹å†™ UI ã€äº¤äº’çš„å‰æä¸‹ï¼Œå¯¹è¯¥é¡¹ç›®å®Œæˆäº†é‡å†™ã€‚é‡å†™ä¹‹åçš„ egg-cnode å…·æœ‰æ›´å¥½çš„ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å¯ç»´æŠ¤æ€§ä¸Šï¼Œæœ‰æå¤§ç¨‹åº¦ä¸Šçš„æ”¹è¿›ï¼Œåœ¨æµ‹è¯•è¦†ç›–ç‡æ–¹é¢ï¼Œä»¥æ›´å°‘çš„ä»£ç é‡å®ç°äº†æ›´é«˜çš„è¦†ç›–ç‡ã€‚é‡å†™è¿‡ç¨‹å†æ—¶ 3 ä¸ªç¤¼æ‹œï¼Œè´¡çŒ®äººæ•° 10 äººï¼Œä»¥ç¤¾åŒºåä½œçš„å½¢å¼å®Œæˆã€‚\r\n\r\næˆ‘ä»¬å°†åœ¨ç¨åçš„ä¸€ä¸ªæ—¶é—´å°†æ–°çš„ç‰ˆæœ¬è¿›è¡Œä¸Šçº¿æµ‹è¯•ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘ä»¬æ–°çš„ä»£ç ä»“åº“ã€‚æœ€åæ„Ÿè°¢ï¼š@sinchangã€@thonatosã€@lqs469 ç­‰äººå‚ä¸çš„è´¡çŒ®ã€‚æ¬¢è¿å¤§å®¶ç»§ç»­å…³æ³¨æˆ‘ä»¬çš„é¡¹ç›®ã€‚",title:"ã€å…¬æµ‹ä¸­ã€‘åŸºäº Egg çš„ CNode ç¤¾åŒº",last_reply_at:"2018-04-02T16:30:46.203Z",good:!1,top:!0,reply_count:71,visit_count:5974,create_at:"2018-03-18",author:{loginname:"JacksonTian",avatar_url:"https://avatars3.githubusercontent.com/u/327019?v=4&s=120"}},{id:"5abda42674fe2526d62220d4",author_id:"4efc278525fa69ac69000013",tab:"share",content:"RTã€‚",title:"è¯·ä¸è¦å†å‘è–…ç¾Šæ¯›å¸–å­",last_reply_at:"2018-04-02T08:53:07.607Z",good:!1,top:!0,reply_count:9,visit_count:1244,create_at:"2018-03-30",author:{loginname:"JacksonTian",avatar_url:"https://avatars3.githubusercontent.com/u/327019?v=4&s=120"}},{id:"5ab34443e7b166bb7b9ecd06",author_id:"596a2b5edb0b6aec18a28569",tab:"share",content:"åŠ å…¥cnodejsç¤¾åŒºä¹Ÿå¿«1å¹´äº†ï¼Œæ²¡å¯¹ç¤¾åŒºåšè¿‡ä»€ä¹ˆè´¡çŒ®ï¼Œçœ‹åˆ°ç¤¾åŒºè¦å…¬æµ‹ï¼Œåˆšå¥½è‡ªå·±åœ¨å…¬å¸ä½¿ç”¨node.jsåšè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚\r\nè¿™æ¬¡æˆ‘è¦å¯¹ç¤¾åŒºè´¡çŒ®ä¸€å¥—UIè‡ªåŠ¨åŒ–ä»£ç ï¼Œåˆ«äººå¦‚æœæƒ³è‡ªå·±æ­å»ºä¸€å¥—ç¤¾åŒºçš„è¯ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œè¿™å¥—UIè‡ªåŠ¨åŒ–ä»£ç æ¥æ£€æŸ¥UIåŠŸèƒ½ã€‚\r\nå¹³æ—¶å·¥ä½œæ—¶é—´æ¯”è¾ƒå¿™ï¼Œæ‰€ä»¥æœ¬å‘¨æ—¥æˆ‘è®¡åˆ’è¦åšå¦‚ä¸‹çš„äº‹æƒ…ï¼Œ\r\nä¸ºäº†è®©å¤§å®¶éƒ½èƒ½çœ‹æ‡‚æˆ‘çš„ä»£ç ï¼Œæˆ‘ä¼šä½¿ç”¨è¡Œä¸ºé©±åŠ¨æµ‹è¯•çš„æ–¹å¼æ¥å†™ä»£ç ï¼Œå®Œæˆä¹‹åçš„ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š\r\n![image.png](//dn-cnode.qbox.me/FpAr57XACJfit4rzN4sa2BBulYUj)\r\nå¯ä»¥é€šè¿‡æŸ¥é˜…æ–‡å­—æè¿°äº†è§£æµ‹è¯•çš„åŠŸèƒ½ç‚¹ã€‚\r\n\r\nç°åœ¨æˆ‘æƒ³æ‹‰ä¸ªå¾®ä¿¡ç¾¤ï¼Œå¦‚æœå„ä½æœ‰å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¥åšã€‚ä¸ä¼šå†™ä»£ç ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¥å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ–è€…ç»™æˆ‘ä»¬å†™çš„æµ‹è¯•ç”¨ä¾‹æå»ºè®®ã€‚\r\n![å¾®ä¿¡å›¾ç‰‡_20180322133956.png](//dn-cnode.qbox.me/FlVUhc1vFM8HAnb0jH1hRHfT6Nu5)",title:"ä¸ºç¤¾åŒºåšè´¡çŒ®ï¼Œå¸®ç¤¾åŒºå†™è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ",last_reply_at:"2018-03-29T08:45:54.750Z",good:!1,top:!0,reply_count:25,visit_count:2601,create_at:"2018-03-22",author:{loginname:"imzengyang",avatar_url:"https://avatars1.githubusercontent.com/u/22312483?v=4&s=120"}},{id:"5ac2f0ae96f344940fbbaca6",author_id:"5a9d2f0989a57ad544fa4279",tab:"share",content:"koa æ¡†æ¶æ˜¯åŸºäº Node.js ä¸‹ä¸€ä»£çš„ web server æ¡†æ¶, èˆå¼ƒäº†å›è°ƒå†™æ³•, æé«˜äº†é”™è¯¯å¤„ç†æ•ˆç‡, è€Œä¸”å…¶ä¸ç»‘å®šä»»ä½•ä¸­é—´ä»¶, æ ¸å¿ƒä»£ç åªæä¾›ä¼˜é›…è½»é‡çš„å‡½æ•°åº“.\r\nå¹³æ—¶ç»å¸¸ä½¿ç”¨åˆ° koa æ¡†æ¶, æ‰€ä»¥å¸Œæœ›é€šè¿‡é˜…è¯»æºç å­¦ä¹ å…¶æ€æƒ³, æœ¬æ–‡æ˜¯åŸºäº koa2 çš„æºç è¿›è¡Œåˆ†æ.\r\n## koa æ•´ä½“æ¶æ„\r\nkoa æ¡†æ¶çš„æºç ç»“æ„éå¸¸ç®€å•, åœ¨ lib æ–‡ä»¶å¤¹ä¸‹, åªæœ‰ 4 ä¸ªæ–‡ä»¶, åˆ†åˆ«æ˜¯ application.js, context.js, request.js, response.js.\r\nè€Œ application.js æ˜¯ koa æ¡†æ¶çš„å…¥å£æ–‡ä»¶, context.js çš„ä½œç”¨æ˜¯åˆ›å»ºç½‘ç»œè¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡, request.js æ˜¯ç”¨äºåŒ…è£… koa çš„ request å¯¹è±¡çš„, response.js\r\nåˆ™æ˜¯ç”¨äºåŒ…è£… koa çš„ response å¯¹è±¡çš„. æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ koa æ¡†æ¶å»ºç«‹ä¸€ä¸ªç®€å•çš„ node æœåŠ¡, ä»¥æ­¤æ¥é€æ­¥äº†è§£ koa å†…éƒ¨æœºç†.\r\n```\r\nconst koa = require('koa');\r\n\r\nconst app = new koa();\r\n\r\napp.use(async (ctx, next) {\r\n  ctx.body = 'Hello World';\r\n});\r\n\r\napp.listen(3000);\r\n```\r\nä¸Šé¢çš„ä»£ç , å…ˆç”Ÿæˆäº†ä¸€ä¸ª koa å¯¹è±¡, ç„¶åé€šè¿‡ä½¿ç”¨ use å‡½æ•°å¾€ server ä¸­æ·»åŠ ä¸­é—´ä»¶å‡½æ•°, æœ€åä½¿ç”¨ listen å‡½æ•°è¿›è¡Œå¯¹ 3000 ç«¯å£çš„ç›‘å¬.\r\n## koa æºç å‰–æ\r\nç”±ä¸Šé¢çš„ç®€å•ä»£ç , æˆ‘ä»¬ä¼šæœ‰å‡ ä¸ªç–‘é—®: koa å¯¹è±¡ä¸­åŒ…å«äº†äº›ä»€ä¹ˆå±æ€§ä¸æ–¹æ³•? use å‡½æ•°å¯¹äºä¸­é—´ä»¶å‡½æ•°çš„å¤„ç†æ˜¯æ€ä¹ˆæ ·çš„? listen å‡½æ•°åšäº†ä»€ä¹ˆ?\r\nå› æ­¤æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ application.js çš„æºç :\r\n### application.js\r\napplication.js æš´éœ²äº†ä¸€ä¸ª Application ç±»ä¾›æˆ‘ä»¬ä½¿ç”¨, ä¹Ÿå³æ˜¯è¯´, æˆ‘ä»¬ new ä¸€ä¸ª koa å¯¹è±¡å®è´¨ä¸Šå°±æ˜¯æ–°å»ºä¸€ä¸ª Application çš„å®ä¾‹å¯¹è±¡. è€Œ Application ç±»æ˜¯ç»§æ‰¿\r\näº EventEmitter (Node.js events æ¨¡å—)çš„, æ‰€ä»¥æˆ‘ä»¬åœ¨ koa å®ä¾‹å¯¹è±¡ä¸Šå¯ä»¥ä½¿ç”¨ on, emit ç­‰æ–¹æ³•è¿›è¡Œäº‹ä»¶ç›‘å¬.\r\n#### ç”Ÿæˆ application å¯¹è±¡\r\n```\r\nconstructor() {\r\n  super(); // å› ä¸ºç»§æ‰¿äº EventEmitter, è¿™é‡Œéœ€è¦è°ƒç”¨ super\r\n\r\n  this.proxy = false; // ä»£ç†è®¾ç½®\r\n  this.middleware = [];\r\n  this.subdomainOffset = 2; // å­åŸŸååç§»è®¾ç½®\r\n  this.env = process.env.NODE_ENV || 'development'; // node ç¯å¢ƒå˜é‡\r\n  this.context = Object.create(context);\r\n  this.request = Object.create(request);\r\n  this.response = Object.create(response);\r\n}\r\n```\r\nå¯ä»¥çœ‹åˆ°åœ¨ constructor å‡½æ•°ä¸­, å®ä¾‹å¯¹è±¡ä¼šåˆå§‹åŒ–å‡ ä¸ªé‡è¦çš„å±æ€§, proxy å±æ€§æ˜¯ä»£ç†è®¾ç½®, middleware å±æ€§æ˜¯ä¸­é—´ä»¶æ•°ç»„, ç”¨äºå­˜å‚¨ä¸­é—´ä»¶å‡½æ•°çš„, subdomainOffset å±æ€§æ˜¯å­åŸŸååç§»é‡\r\nè®¾ç½®, env å±æ€§ä¿å­˜ node çš„ç¯å¢ƒå˜é‡ NODE_ENV å€¼, context, requets, response åˆ™æ˜¯ koa è‡ªèº«çš„åŒ…è£…çš„ context å¯¹è±¡, request å¯¹è±¡, response å¯¹è±¡. è¿™é‡Œç‰¹åˆ«è®²è§£ä¸€ä¸‹ proxy å±æ€§ä¸\r\nsubdomainOffset å±æ€§. proxy å±æ€§å€¼æ˜¯ true æˆ–è€… false, å®ƒçš„ä½œç”¨åœ¨äºæ˜¯å¦è·å–çœŸæ­£çš„å®¢æˆ·ç«¯ ip åœ°å€(è¯¦ç»†è¯·çœ‹é™„å½•çš„ç¬¬ä¸€ç‚¹). subdomainOffset å±æ€§ä¼šæ”¹å˜è·å– subdomain æ—¶è¿”å›æ•°ç»„çš„å€¼,\r\næ¯”å¦‚ test.page.example.com åŸŸå, å¦‚æœè®¾ç½® subdomainOffset ä¸º 2, é‚£ä¹ˆè¿”å›çš„æ•°ç»„å€¼ä¸º [\"page\", \"test\"], å¦‚æœè®¾ç½®ä¸º 3, é‚£ä¹ˆè¿”å›æ•°ç»„å€¼ä¸º [\"test\"].\r\n#### use ä¸ä¸­é—´ä»¶\r\nuse å‡½æ•°å†…éƒ¨ä»…ä»…æ˜¯å¯¹ generator å‡½æ•°åˆ©ç”¨ koa-convert åº“è¿›è¡Œè½¬åŒ–(å°† generator å‡½æ•°åŒ…è£…æˆ Promise), å¦‚æœä¸æ˜¯åˆ™ä¸è½¬åŒ–, ç„¶åå°†è¿™ä¸ªä¸­é—´ä»¶å‡½æ•° push è¿›å®ä¾‹å¯¹è±¡çš„ middleware æ•°ç»„ä¸­.\r\næ‰€ä»¥, æ‰€è°“ä¸­é—´ä»¶å‡½æ•°çš„ä¸²è”å…¶å®å°±æ˜¯é€šè¿‡æ•°ç»„æ¥é€ä¸ªæ‰§è¡Œçš„, è‡³äº koa æ˜¯æ€ä¹ˆåˆ©ç”¨ koa-compose å»ºç«‹èµ·æ ¸å¿ƒçš„ä¸­é—´ä»¶æœºåˆ¶çš„, è¿™é‡ŒæŒ‰ä¸‹ä¸è¡¨, è¯¦ç»†è¯·é˜…è¯»æœ¬äººçš„ [ç†è§£ koa ä¸­é—´ä»¶æœºåˆ¶](http://zhangxiang958.github.io/2018/03/16/%E7%90%86%E8%A7%A3%20Koa%20%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9C%BA%E5%88%B6/) åšæ–‡.\r\n#### listen åŸç†\r\nlisten å‡½æ•°çš„åŸç†å…¶å®å¾ˆç®€å•, å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç¼©å†™çš„å‡½æ•°, å®ƒæœ¬è´¨ä¸Šå°±æ˜¯åœ¨å†…éƒ¨é€šè¿‡ Node åŸç”Ÿçš„ http æ¨¡å—å»ºç«‹èµ·ä¸€ä¸ª http server, è€Œè¿™ä¸ª http server çš„å›è°ƒå‡½æ•°ä½¿ç”¨çš„æ˜¯ koa ä¸­çš„ callback å‡½æ•°.\r\n```\r\nlisten(...args) {\r\n  debug('listen');\r\n  const server = http.createServer(this.callback());\r\n  return server.listen(...args);\r\n}\r\n```\r\nä¸‹é¢å°±æ¥è®²è§£ä¸€ä¸‹æ ¸å¿ƒçš„ callback å‡½æ•°.\r\n```\r\ncallback() {\r\n  const fn = compose(this.middleware);  // ä½¿ç”¨ compose å»ºç«‹ä¸­é—´ä»¶æœºåˆ¶, è¯¦æƒ…è¯·çœ‹ http://zhangxiang958.github.io/2018/03/16/%E7%90%86%E8%A7%A3%20Koa%20%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9C%BA%E5%88%B6/\r\n\r\n  if (!this.listeners('error').length) this.on('error', this.onerror);  // å¦‚æœæ²¡æœ‰å¯¹ error äº‹ä»¶è¿›è¡Œç›‘å¬, é‚£ä¹ˆç»‘å®š error äº‹ä»¶ç›‘å¬å¤„ç†\r\n\r\n  // handleRequest å‡½æ•°ç›¸å½“äº http.creatServer çš„å›è°ƒå‡½æ•°, æœ‰ req, res ä¸¤ä¸ªå‚æ•°, ä»£è¡¨åŸç”Ÿçš„ request, response å¯¹è±¡.\r\n  const handleRequest = (req, res) => {\r\n    const ctx = this.createContext(req, res); // æ¯æ¬¡æ¥å—ä¸€ä¸ªæ–°çš„è¯·æ±‚å°±æ˜¯ç”Ÿæˆä¸€æ¬¡å…¨æ–°çš„ context\r\n    return this.handleRequest(ctx, fn);\r\n  };\r\n\r\n  return handleRequest;\r\n}\r\n\r\nhandleRequest(ctx, fnMiddleware) {\r\n  const res = ctx.res;\r\n  res.statusCode = 404;\r\n  const onerror = err => ctx.onerror(err); // é”™è¯¯å¤„ç†\r\n  const handleResponse = () => respond(ctx); // å“åº”å¤„ç†\r\n  onFinished(res, onerror); // ä¸º res å¯¹è±¡æ·»åŠ é”™è¯¯å¤„ç†å“åº”, å½“ res å“åº”ç»“æŸæ—¶, æ‰§è¡Œ context ä¸­çš„ onerror å‡½æ•°(è¿™é‡Œéœ€è¦æ³¨æ„åŒºåˆ† context ä¸ koa å®ä¾‹ä¸­çš„ onerror)\r\n  return fnMiddleware(ctx).then(handleResponse).catch(onerror); // æ‰§è¡Œä¸­é—´ä»¶æ•°ç»„æ‰€æœ‰å‡½æ•°, å¹¶ç»“æŸæ—¶è°ƒç”¨ respond å‡½æ•°\r\n}\r\n```\r\nå¯¹äº this.createContext å‡½æ•°, å®ƒçš„ç”¨äºå°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ context å¯¹è±¡å¹¶å»ºç«‹ koa ä¸­ context, requets, response å±æ€§ä¹‹é—´ä¸åŸç”Ÿ http å¯¹è±¡çš„å…³ç³»çš„.è€Œ handleRequest å‡½æ•°åªæ˜¯è´Ÿè´£æ‰§è¡Œ\r\nä¸­é—´ä»¶æ‰€æœ‰çš„å‡½æ•°, å¹¶åœ¨ä¸­é—´ä»¶å‡½æ•°æ‰§è¡Œç»“æŸçš„æ—¶å€™è°ƒç”¨ respond.\r\nå¯¹äºåœ¨ koa ä¸­çš„ context å¯¹è±¡, request å¯¹è±¡, response å¯¹è±¡ä¸ http æ¨¡å—åŸç”Ÿçš„ req ä¸ res ä¹‹é—´çš„å…³ç³»æˆ‘å¹¶ä¸æ‰“ç®—é™ˆåˆ—ä»£ç , ä¸‹é¢æˆ‘ä»¥å›¾è§£çš„å½¢å¼æ¥å¸®åŠ©é˜…è¯»:\r\n![](http://ofsur12wi.bkt.clouddn.com/applicaton.png)\r\n#### å¯¹è¯·æ±‚çš„å“åº”å¤„ç† respond\r\nå¯¹äº respond å‡½æ•°, å…¶æ ¸å¿ƒå°±æ˜¯æ ¹æ®ä¸åŒç±»å‹çš„æ•°æ®å¯¹ http çš„å“åº”å¤´éƒ¨ä¸å“åº”ä½“ body åšå¯¹åº”çš„å¤„ç†.\r\n```\r\nfunction respond(ctx) {\r\n  // allow bypassing koa\r\n  if (false === ctx.respond) return;\r\n\r\n  const res = ctx.res;\r\n  // writable æ˜¯åŸç”Ÿçš„ response å¯¹è±¡çš„ writeable å±æ€§, æ£€æŸ¥æ˜¯å¦æ˜¯å¯å†™æµ\r\n  if (!ctx.writable) return;\r\n\r\n  let body = ctx.body;\r\n  const code = ctx.status;\r\n\r\n  // ignore body\r\n  // å¦‚æœå“åº”çš„ statusCode æ˜¯å±äº body ä¸ºç©ºçš„ç±»å‹, ä¾‹å¦‚ 204, 205, 304, å°† body ç½®ä¸º null\r\n  if (statuses.empty[code]) {\r\n    // strip headers\r\n    ctx.body = null;\r\n    return res.end();\r\n  }\r\n\r\n  // å¦‚æœæ˜¯ HEAD æ–¹æ³•\r\n  if ('HEAD' == ctx.method) {\r\n    // headersSent å±æ€§ Node åŸç”Ÿçš„ response å¯¹è±¡ä¸Šçš„, ç”¨äºæ£€æŸ¥ http å“åº”å¤´éƒ¨æ˜¯å¦å·²ç»è¢«å‘é€\r\n    // å¦‚æœå¤´éƒ¨æœªè¢«å‘é€, é‚£ä¹ˆæ·»åŠ  length å¤´éƒ¨\r\n    if (!res.headersSent && isJSON(body)) {\r\n      ctx.length = Buffer.byteLength(JSON.stringify(body));\r\n    }\r\n    return res.end();\r\n  }\r\n\r\n  // status body\r\n  // å¦‚æœ body å€¼ä¸ºç©º\r\n  if (null == body) {\r\n    // body å€¼ä¸º context ä¸­çš„ message å±æ€§æˆ– code\r\n    body = ctx.message || String(code);\r\n    // ä¿®æ”¹å¤´éƒ¨çš„ type ä¸ length å±æ€§\r\n    if (!res.headersSent) {\r\n      ctx.type = 'text';\r\n      ctx.length = Buffer.byteLength(body);\r\n    }\r\n    return res.end(body);\r\n  }\r\n\r\n  // responses\r\n  // å¯¹ body ä¸º buffer ç±»å‹çš„è¿›è¡Œå¤„ç†\r\n  if (Buffer.isBuffer(body)) return res.end(body);\r\n  // å¯¹ body ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„è¿›è¡Œå¤„ç†\r\n  if ('string' == typeof body) return res.end(body);\r\n  // å¯¹ body ä¸ºæµå½¢å¼çš„è¿›è¡Œå¤„ç†\r\n  if (body instanceof Stream) return body.pipe(res);\r\n\r\n  // body: json\r\n  // å¯¹ body ä¸º json æ ¼å¼çš„æ•°æ®è¿›è¡Œå¤„ç†, 1: å°† body è½¬åŒ–ä¸º json å­—ç¬¦ä¸², 2: æ·»åŠ  length å¤´éƒ¨ä¿¡æ¯\r\n  body = JSON.stringify(body);\r\n  if (!res.headersSent) {\r\n    ctx.length = Buffer.byteLength(body);\r\n  }\r\n  res.end(body);\r\n}\r\n```\r\nåœ¨ respond å‡½æ•°ä¸­, ä¸»è¦æ˜¯è¿ç”¨ node http æ¨¡å—ä¸­çš„å“åº”å¯¹è±¡ä¸­çš„ end æ–¹æ³•ä¸ koa context å¯¹è±¡ä¸­ä»£ç†çš„å±æ€§è¿›è¡Œæœ€ç»ˆå“åº”å¯¹è±¡çš„è®¾ç½®.\r\n### request.js\r\nä¸»è¦æ˜¯å¯¹åŸç”Ÿçš„ http æ¨¡å—çš„ requets å¯¹è±¡è¿›è¡Œå°è£…, å…¶å®å°±æ˜¯å¯¹ request å¯¹è±¡æŸäº›å±æ€§æˆ–æ–¹æ³•é€šè¿‡é‡å†™ getter/setter å‡½æ•°è¿›è¡Œä»£ç†, è¯·çœ‹ä¸‹é¢çš„å›¾è¿›è¡Œæ›´å¥½çš„ç†è§£:\r\n![request](http://ofsur12wi.bkt.clouddn.com/reuqest.png)\r\n#### å†…å®¹åå•†\r\næˆ‘ä»¬å¯ä»¥çœ‹åˆ° request ä¸­æœ‰å¾ˆå¤š accept ç›¸å…³çš„æ–¹æ³•, æˆ‘ä»¬æ¥çœ‹çœ‹ accept ç›¸å…³çš„å†…å®¹åå•†çš„çŸ¥è¯†:\r\næ‰€è°“å†…å®¹åå•†, å°±æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚æ–‡ä»¶, è¿”å›ç¬¦åˆæŸäº›æ ‡å‡†çš„æ–‡ä»¶, è€Œé™¤äº†æœåŠ¡ç«¯å°†æ‰€æœ‰ç‰ˆæœ¬çš„æ–‡ä»¶å…¨éƒ¨è¿”å›ç”±\r\nå®¢æˆ·ç«¯æ¥å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬è¿™ç§æ¯”è¾ƒæµªè´¹ç½‘ç»œèµ„æºçš„æ–¹æ³•ä¹‹å¤–, æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨é€šè¿‡è¯·æ±‚/å“åº”å¤´éƒ¨è¿›è¡Œäº¤æµå¹¶è¿”å›åˆé€‚\r\nç‰ˆæœ¬çš„æ–¹æ³•.\r\n\r\n| è¯·æ±‚å¤´å­—æ®µ | è§£é‡Š | å¯¹åº”å“åº”å¤´ | \r\n| - | :-: | -: | \r\n| Accept | å‘Šè¯‰æœåŠ¡ç«¯å¯ä»¥æ¥æ”¶çš„ç±»å‹(text/html, application/json ç­‰) | Content-Type | \r\n| Accept-charset | å‘Šè¯‰æœåŠ¡ç«¯å¯ä»¥æ¥æ”¶çš„å­—ç¬¦é›†ç±»å‹(utf8, GBK ç­‰) | Content-Type |\r\n| Accept-Encoding | å‘Šè¯‰æœåŠ¡ç«¯å¯ä»¥æ¥æ”¶çš„å‹ç¼©ç±»å‹(gzip, deflate ç­‰) | Content-Encoding | \r\n| Accept-Language | å‘Šè¯‰æœåŠ¡ç«¯å¯ä»¥æ¥å—çš„è¯­è¨€ç±»å‹(zh-CN, en ç­‰) | Content-Language |\r\n\r\nä½¿ç”¨ä¸Šé¢çš„å¤´éƒ¨å­—æ®µå°±å¯ä»¥è¾¾åˆ°è¯·æ±‚åˆé€‚çš„æ–‡æ¡£ç±»å‹.è€Œå¯¹äºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´å¯èƒ½æœ‰å¤šä¸ªå®ä½“, æ¯”å¦‚ CDN, ç¼“å­˜æœåŠ¡\r\nå™¨ç­‰ç­‰, ä¸‡ä¸€ä¸­é—´å®ä½“ç¼“å­˜äº†é”™è¯¯çš„æ–‡ä»¶ç‰ˆæœ¬, é‚£ä¹ˆåæœå°±æ˜¯å®¢æˆ·ç«¯æœ‰å¯èƒ½æ— æ³•æ­£ç¡®åœ°è§£æè¯¥æ–‡ä»¶.æ‰€ä»¥éœ€è¦ vary å“åº”\r\nå¤´éƒ¨å­—æ®µ, vary å­—æ®µçš„å€¼ç±»ä¼¼äºè¿™æ ·: vary: user-agent, location. vary å­—æ®µæ˜¯å‘Šè¯‰ä¸­é—´å®ä½“å¦‚ä½•æ­£ç¡®åˆ¤æ–­æœ‰æ•ˆçš„\r\nç¼“å­˜æ–‡ä»¶ç‰ˆæœ¬, æ¯”å¦‚åƒä¸Šé¢çš„å€¼, é‚£å°±æ˜¯åˆ©ç”¨è¯·æ±‚çš„ user-agent, location ä¸¤ä¸ªå¤´éƒ¨çš„å­—æ®µç”Ÿæˆçš„ hash, å¦‚æœå†æœ‰è¯·\r\næ±‚è¿‡æ¥å¹¶ä¸”è¯·æ±‚çš„ ua ä¸ location å¤´éƒ¨å­—æ®µç”Ÿæˆçš„ hash æœ‰ç¼“å­˜, é‚£ä¹ˆå°±è¿”å›å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶.\r\n### response.js\r\nåŒæ ·çš„, response ä¹Ÿæ˜¯å¯¹ http æ¨¡å—çš„ response å¯¹è±¡è¿›è¡Œå°è£…, é€šè¿‡å¯¹ response å¯¹è±¡çš„æŸäº›å±æ€§æˆ–æ–¹æ³•é€šè¿‡é‡å†™ getter/setter å‡½æ•°è¿›è¡Œä»£ç†, è¯·çœ‹ä¸‹é¢çš„å›¾å¸®åŠ©ç†è§£:\r\n![response](http://ofsur12wi.bkt.clouddn.com/koaresponse.png)\r\n\r\n#### Content-disposition\r\nåœ¨ response å¯¹è±¡çš„ attachment æ–¹æ³•ä¸­, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹ HTTP å¤´éƒ¨çš„ Content-disposition å­—æ®µè¿›è¡Œäº†å¤„ç†, é‚£ä¹ˆç©¶ç«Ÿ Content-disposition å­—æ®µæ˜¯åšä»€ä¹ˆç”¨çš„?\r\nContent-disposition æ˜¯ç”¨äºè¯´æ˜è¿™ä¸ªè¿”å›çš„ä¿¡æ¯æ˜¯ä»¥ä»€ä¹ˆå½¢å¼å±•ç¤ºçš„, ä¾‹å¦‚å¦‚æœå€¼ä¸º inline, é‚£ä¹ˆå°±æ˜¯ä»¥ç½‘é¡µçš„ä¸€éƒ¨åˆ†æˆ–è€…æ•´ä¸ªé¡µé¢å±•ç¤º, å¦‚æœæ˜¯ attachment çš„è¯, å°±æ˜¯ä»¥ä¸‹è½½é™„ä»¶çš„\r\nå½¢å¼å±•ç¤º:\r\n```\r\nContent-Disposition: inline; // ç½‘é¡µä¸€éƒ¨åˆ†æˆ–è€…æ•´ä¸ªç½‘é¡µå±•ç¤º\r\nContent-Disposition: attachment; // ä¸‹è½½ç½‘é¡µé™„ä»¶çš„å½¢å¼\r\nContent-Disposition: attachment, filename=\"xxx.ext\"; // è¿˜å¯ä»¥ä½¿ç”¨ filename æ¥æŒ‡å®šæ–‡ä»¶å\r\n```\r\nå½“ç„¶, åœ¨ Content-Type ä¸º multipart/form-data æ ¼å¼ä¸­, Content-Disposition ä¹Ÿä¼šå‘æŒ¥ä½œç”¨, ç”¨äºå®šä¹‰è¡¨å•çš„é”®å:\r\n```\r\nContent-Type: multipart/form; boundry=\"boundry\"\r\n\r\n--boundry\r\nContent-Disposition: form-data; name=\"field1\"\r\n\r\nvalue\r\n--boundry\r\nContent-Disposition: form-data; name=\"field2\"\r\n\r\nvalue\r\n```\r\n#### ç¼“å­˜åå•†\r\nåœ¨ request ä¸­ä½¿ç”¨ fresh å­—æ®µæ¥åˆ¤æ–­è¿™ä¸ªè¯·æ±‚éœ€è¦çš„å†…å®¹æ˜¯å¦æ˜¯æœ€æ–°çš„, å…¶åŸç†ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ http ç¼“å­˜æœºåˆ¶, å†…éƒ¨é€šè¿‡ fresh è¿™ä¸ªåº“, åˆ¤æ–­è¯·æ±‚å¤´éƒ¨ä¸­çš„ if-modify-since ä¸\r\nif-match-since å¯¹æ¯”äºå“åº”å¤´éƒ¨ä¸­çš„ last-Modified å­—æ®µä¸ ETag å­—æ®µ.å½“ç„¶, åœ¨æ£€æŸ¥è¿™ä¸¤ä¸ªå­—æ®µä¹‹å‰, è¿˜éœ€è¦æ£€æŸ¥ä¸€ä¸‹è¯·æ±‚å¤´éƒ¨çš„ Cache-Control å¤´éƒ¨, å¦‚æœ Cache-Control å¤´éƒ¨\r\næ˜¯ no-cache, é‚£ä¹ˆå°±ä»£è¡¨è¯·æ±‚ä¿¡æ¯å¿…é¡»æ˜¯æœ€æ–°çš„, å¦‚æœä¸æ˜¯ no-cache, æ¥ç€å°±éœ€è¦åˆ¤æ–­ä¸Šé¢è¯´çš„ä¸¤ä¸ªå­—æ®µ.è€Œ last-modified ä¸ ETag çš„æ£€æŸ¥æœ‰æ²¡æœ‰ä¼˜å…ˆé¡ºåºå‘¢? ç­”æ¡ˆæ˜¯æœ‰çš„.\r\nkoa ä¸­å…ˆæ£€æŸ¥ ETag æœ‰æ²¡æœ‰è¿‡æœŸ, æ‰‹æ®µæ˜¯é€šè¿‡æ£€æŸ¥ if-match-since å­—æ®µä¸ Etag å­—æ®µæ˜¯å¦ç›¸åŒ, ç„¶åä¼šæ£€æŸ¥ last-modified æœ‰æ²¡æœ‰è¿‡æœŸ, æ‰‹æ®µæ˜¯é€šè¿‡æ£€æŸ¥ if-modify-since ä¸ last-modified\r\nçš„æ—¥æœŸæ˜¯ä¸æ˜¯ last-modified æ—¥æœŸæ—¶é—´æˆ³å°äº if-modified-since æ—¥æœŸæ—¶é—´æˆ³, å¦‚æœæ˜¯é‚£ä¹ˆè¯´æ˜å†…å®¹æ˜¯æ–°é²œçš„, å¦‚æœä¸æ˜¯è¯´æ˜å†…å®¹æ˜¯æ—§çš„.\r\n\r\n### context.js\r\nåˆ†æäº†ä¸Šé¢çš„ request ä¸ response, context çš„åˆ†ææ›´ä¸ºç®€å•äº†, context çš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡ delegates è¿™ä¸€ä¸ªåº“, å°† request, response å¯¹è±¡ä¸Šçš„å±æ€§æ–¹æ³•ä»£ç†åˆ° context å¯¹è±¡ä¸Š.\r\nä¹Ÿå°±æ˜¯è¯´ä¾‹å¦‚ this.ctx.headersSent ç›¸å½“äº this.response.headersSent. request å¯¹è±¡ä¸ response å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ä¸å±æ€§éƒ½èƒ½åœ¨ ctx å¯¹è±¡ä¸Šæ‰¾åˆ°. è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ delegates åº“\r\nçš„å±æ€§ä»£ç†å‡½æ•°çš„ç‰‡æ®µ, å€Ÿæ­¤ç†è§£ä¸€ä¸‹ context æ˜¯å¦‚ä½•ä»£ç† request ä¸ response ä¸Šçš„å±æ€§ä¸æ–¹æ³•çš„:\r\n```\r\ndelegate(proto, 'response')\r\n  .getter('headerSent');\r\n```\r\n```\r\nDelegator.prototype.getter = function(name){\r\n  // this.proto æŒ‡å‘åŸå‹, è¿™é‡Œçš„ proto å°±æ˜¯ä¸Šé¢çš„ proto, ä¹Ÿå°±æ˜¯è¯´ context å¯¹è±¡\r\n  var proto = this.proto;\r\n  // target æ˜¯æŒ‡ 'response' å­—ç¬¦ä¸²\r\n  var target = this.target;\r\n  // å°† name åŠ å…¥åˆ° delegator å®ä¾‹å¯¹è±¡çš„ getters æ•°ç»„ä¸­\r\n  this.getters.push(name);\r\n  // è°ƒç”¨åŸç”Ÿçš„ __defineGetter__ æ–¹æ³•è¿›è¡Œ getter ä»£ç†, é‚£ä¹ˆ proto[name] å°±ç›¸å½“äº proto[target][name]\r\n  // è€Œ context.response å°±ç›¸å½“äº response å¯¹è±¡\r\n  // ç”±æ­¤å®ç°å±æ€§ä»£ç†\r\n  proto.__defineGetter__(name, function(){\r\n    return this[target][name];\r\n  });\r\n\r\n  return this;\r\n};\r\n```\r\n## é”™è¯¯å¤„ç†\r\nåœ¨ koa ä¸­, é”™è¯¯å¤„ç†åˆ†ä¸ºåœ¨ application.js ä¸­çš„ onerror å¤„ç†å‡½æ•°ä¸åœ¨ context.js ä¸­çš„ onerror å¤„ç†å‡½æ•°.è¿™ä¸¤è€…ç»‘å®šçš„ä½ç½®æ˜¯ä¸ä¸€æ ·çš„, context çš„ onerror å‡½æ•°æ˜¯ç»‘å®šåœ¨\r\nä¸­é—´å‡½æ•°æ•°ç»„ç”Ÿæˆçš„ Promise çš„ catch ä¸­ä¸ res å¯¹è±¡çš„ onFinished å‡½æ•°çš„å›è°ƒçš„, è¿™é‡Œçš„æ„å›¾æ˜¾è€Œæ˜“è§, å°±æ˜¯ä¸ºäº†å¤„ç†è¯·æ±‚æˆ–å“åº”ä¸­å‡ºç°çš„ error äº‹ä»¶çš„.\r\nè€Œ application.js ä¸­çš„ onerror å‡½æ•°æ˜¯ç»‘å®šåœ¨ koa å®ä¾‹å¯¹è±¡ä¸Šçš„, å®ƒç›‘å¬çš„æ˜¯æ•´ä¸ªå¯¹è±¡çš„ error äº‹ä»¶.\r\n### context ä¸­çš„é”™è¯¯å¤„ç†\r\n```\r\nonerror(err) {\r\n  // don't do anything if there is no error.\r\n  // this allows you to pass `this.onerror`\r\n  // to node-style callbacks.\r\n  // æ²¡æœ‰é”™è¯¯åˆ™å¿½ç•¥, ä¸æ‰§è¡Œä¸‹é¢çš„é€»è¾‘\r\n  if (null == err) return;\r\n  // å°†é”™è¯¯è½¬åŒ–ä¸º Error å®ä¾‹\r\n  if (!(err instanceof Error)) err = new Error(util.format('non-error thrown: %j', err));\r\n\r\n  let headerSent = false;\r\n  if (this.headerSent || !this.writable) {\r\n    headerSent = err.headerSent = true;\r\n  }\r\n\r\n  // delegate\r\n  // è§¦å‘ koa å®ä¾‹å¯¹è±¡çš„ error äº‹ä»¶, application ä¸Šçš„ onerror å‡½æ•°ä¼šæ‰§è¡Œ\r\n  this.app.emit('error', err, this);\r\n\r\n  // nothing we can do here other\r\n  // than delegate to the app-level\r\n  // handler and log.\r\n  // å¦‚æœå“åº”å¤´éƒ¨å·²ç»å‘é€(æˆ–è€… socket ä¸å¯å†™), é‚£ä¹ˆé€€å‡ºå‡½æ•°\r\n  if (headerSent) {\r\n    return;\r\n  }\r\n  // è·å– http åŸç”Ÿ res å¯¹è±¡\r\n  const { res } = this;\r\n  \r\n  // first unset all headers\r\n  // æ ¹æ®æ–‡æ¡£ res.getHeaderNames å‡½æ•°æ˜¯ 7.7.0 ç‰ˆæœ¬åæ·»åŠ çš„, è¿™é‡Œä¸ºäº†å…¼å®¹åšäº†ä¸€ä¸ªåˆ¤æ–­\r\n  // å¦‚æœå‡ºé”™é‚£ä¹ˆä¹‹å‰ä¸­é—´ä»¶æˆ–è€…å…¶ä»–åœ°æ–¹è®¾ç½®çš„ HTTP å¤´éƒ¨å°±æ— æ•ˆäº†, åº”è¯¥æ¸…ç©ºè®¾ç½®\r\n  if (typeof res.getHeaderNames === 'function') {\r\n    res.getHeaderNames().forEach(name => res.removeHeader(name));\r\n  } else {\r\n    res._headers = {}; // Node < 7.7\r\n  }\r\n\r\n  // then set those specified\r\n  this.set(err.headers);\r\n\r\n  // force text/plain\r\n  // å‡ºé”™åå“åº”ç±»å‹ä¸º text/plain\r\n  this.type = 'text';\r\n\r\n  // ENOENT support\r\n  // å¯¹ ENOENT é”™è¯¯è¿›è¡Œå¤„ç†, ENOENT çš„é”™è¯¯ message æ˜¯æ–‡ä»¶æˆ–è€…è·¯å¾„ä¸å­˜åœ¨, æ‰€ä»¥çŠ¶æ€ç åº”è¯¥æ˜¯ 404\r\n  if ('ENOENT' == err.code) err.status = 404;\r\n\r\n  // default to 500\r\n  // é»˜è®¤è®¾ç½®çŠ¶æ€ç ä¸º 500\r\n  if ('number' != typeof err.status || !statuses[err.status]) err.status = 500;\r\n\r\n  // respond\r\n  const code = statuses[err.status];\r\n  const msg = err.expose ? err.message : code;\r\n  // è®¾ç½®å“åº”çŠ¶æ€ç \r\n  this.status = err.status;\r\n  // è®¾ç½®å“åº” body é•¿åº¦\r\n  this.length = Buffer.byteLength(msg);\r\n  // è¿”å› message\r\n  this.res.end(msg);\r\n}\r\n```\r\n### application ä¸­çš„é”™è¯¯å¤„ç†\r\napplication ä¸­çš„é”™è¯¯å¤„ç†æ˜¯å¯¹ koa å®ä¾‹å¯¹è±¡ä¸­ä¾‹å¦‚å‡½æ•°æ‰§è¡Œå‡ºé”™ç­‰ç­‰å†…éƒ¨é”™è¯¯è¿›è¡Œå¤„ç†.\r\n```\r\nonerror(err) {\r\n  // åˆ¤æ–­ err æ˜¯å¦æ˜¯ Error å®ä¾‹\r\n  assert(err instanceof Error, `non-error thrown: ${err}`);\r\n  // å¿½ç•¥ 404 é”™è¯¯\r\n  if (404 == err.status || err.expose) return;\r\n  // å¦‚æœæœ‰é™é»˜è®¾ç½®, åˆ™å¿½ç•¥\r\n  if (this.silent) return;\r\n  // æ‰“å°å‡ºå‡ºé”™å †æ ˆ\r\n  const msg = err.stack || err.toString();\r\n  console.error();\r\n  console.error(msg.replace(/^/gm, '  '));\r\n  console.error();\r\n}\r\n```\r\nè¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¤„ç†å‡ºé”™å‡½æ•°çš„å †æ ˆæ‰“å°, æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œé—®é¢˜å®šä½.\r\n## é™„å½•\r\n### 1. koa ä¸­ proxy å±æ€§çœŸæ­£ç”¨é€”æ˜¯ä»€ä¹ˆ?\r\nè¦çŸ¥é“, æˆ‘ä»¬åœ¨å®é™…è¿ç”¨ä¸­, å¯èƒ½ä¼šä½¿ç”¨å¾ˆå¤šçš„ä»£ç†æœåŠ¡å™¨, åŒ…æ‹¬æˆ‘ä»¬å¸¸è§çš„æ­£å‘ä»£ç†ä¸åå‘ä»£ç†, è™½ç„¶ä»£ç†çš„ç”¨å¤„å¾ˆå¤§, ä½†æ˜¯æ— æ³•é¿å…åœ°æˆ‘ä»¬æœ‰æ—¶éœ€è¦çŸ¥æ™“çœŸæ­£çš„å®¢æˆ·ç«¯çš„è¯·æ±‚ ip,\r\nè€Œå…¶å®å®é™…ä¸Š, æœåŠ¡å™¨å¹¶ä¸çŸ¥é“çœŸæ­£çš„å®¢æˆ·ç«¯è¯·æ±‚ ip, å³ä½¿ä½ ä½¿ç”¨ socket.remoteAddrss å±æ€§æ¥æŸ¥çœ‹, å› ä¸ºè¿™ä¸ªè¯·æ±‚æ˜¯ä»£ç†æœåŠ¡å™¨è½¬å‘ç»™æœåŠ¡å™¨çš„, å¹¸å¥½ä»£ç†æœåŠ¡å™¨ä¾‹å¦‚ nginx æä¾›äº†ä¸€ä¸ª\r\nHTTP å¤´éƒ¨æ¥è®°å½•æ¯æ¬¡ä»£ç†æœåŠ¡å™¨çš„æº IP åœ°å€, ä¹Ÿå°±æ˜¯ X-Forwarded-For å¤´éƒ¨.å½¢å¼å¦‚ä¸‹:\r\n```\r\nX-Forwarded-For: 192.168.210.13, 210.112.40.13, 43.56.210.10\r\n```\r\nå¦‚æœä¸€ä¸ªè¯·æ±‚è·³è½¬äº†å¾ˆå¤šä»£ç†æœåŠ¡å™¨, é‚£ä¹ˆ X-Forwarded-For å¤´éƒ¨çš„ ip åœ°å€å°±ä¼šè¶Šå¤š, ç¬¬ä¸€ä¸ªå°±æ˜¯åŸå§‹çš„å®¢æˆ·ç«¯è¯·æ±‚ ip, ç¬¬äºŒä¸ªå°±æ˜¯ç¬¬ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ ip, ä»¥æ­¤ç±»æ¨.\r\nå½“ç„¶, X-Forwarded-For å¹¶ä¸å®Œå…¨å¯ä¿¡, å› ä¸ºä¸­é—´çš„ä»£ç†æœåŠ¡å™¨å¯èƒ½ä¼š\"ä½¿å\"æ›´æ”¹æŸäº› IP. è€Œ koa ä¸­ proxy å±æ€§çš„è®¾ç½®å°±æ˜¯å¦‚æœä½¿ç”¨ true, é‚£ä¹ˆå°±æ˜¯ä½¿ç”¨ X-Forwarded-For å¤´éƒ¨çš„ç¬¬ä¸€ä¸ª\r\nip åœ°å€, å¦‚æœä½¿ç”¨ false, åˆ™ä½¿ç”¨ server ä¸­çš„ socket.remoteAddress å±æ€§å€¼.\r\né™¤äº† X-Forwarded-For ä¹‹å¤–, proxy è¿˜ä¼šå½±å“ X-Forwarded-proto çš„ä½¿ç”¨, å’Œ X-Forwarded-For ä¸€æ ·, X-Forwarded-proto è®°å½•æœ€å¼€å§‹çš„è¯·æ±‚è¿æ¥ä½¿ç”¨çš„åè®®ç±»å‹(HTTP/HTTPS), å› ä¸ºå®¢æˆ·ç«¯ä¸\r\næœåŠ¡ç«¯ä¹‹é—´å¯èƒ½ä¼šå­˜åœ¨å¾ˆå¤šå±‚ä»£ç†æœåŠ¡å™¨, è€Œä»£ç†æœåŠ¡å™¨ä¸æœåŠ¡ç«¯ä¹‹é—´å¯èƒ½åªæ˜¯ä½¿ç”¨ HTTP åè®®, å¹¶æ²¡æœ‰ä½¿ç”¨ HTTPS, æ‰€ä»¥ proxy å±æ€§ä¸º true çš„è¯, koa çš„ protocol å±æ€§ä¼šå»å– X-Forwarded-proto å¤´éƒ¨\r\nçš„å€¼(koa ä¸­ protocol å±æ€§ä¼šå…ˆä½¿ç”¨ tlsSocket.encrypted å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ https åè®®, å¦‚æœæ˜¯åˆ™ç›´æ¥è¿”å› 'https').\r\n### 2. javascript ä¸­çš„ ~ è¿ç®—ç¬¦\r\n~ è¿ç®—ç¬¦æ˜¯ä¸€å…ƒè¿ç®—ç¬¦, å®ƒçš„è¿ç®—é€»è¾‘æ˜¯å¦‚ä¸‹: ä¾‹å¦‚è®¡ç®— ~1\r\n```\r\n1. å°†åè¿›åˆ¶çš„ 1 è½¬åŒ–ä¸ºäºŒè¿›åˆ¶çš„ 0001\r\n2. å…ˆå¯¹ 0001 æŒ‰ä½å–å: 1110\r\n3. ç„¶åæˆ‘ä»¬çŸ¥é“æœ€é«˜ä½ä¸º 1, æ‰€ä»¥æ•°å­—ä¸ºè´Ÿæ•°, ç„¶åå°†é™¤å»æœ€é«˜ä½å‰©ä¸‹çš„ä¸‰ä½æ•°å­—å†æŒ‰ä½å–åå¾—åˆ° 001\r\n4. ç„¶åå†å‘ 001 åŠ  1 å³ 001 + 001 å¾—åˆ° 010, è½¬ä¸ºåè¿›åˆ¶ä¸ºæ•°å­— 2\r\n5. å†åŠ ä¸Šæˆ‘ä»¬ä¹‹å‰æœ€é«˜ä½ä¸º 1, æ‰€ä»¥æœ€åæ•°å­—ä¸ºè´Ÿæ•°å³ -2\r\n6. æ‰€ä»¥ ~1 === -2\r\n```\r\nç”¨ç®€ç•¥çš„è¡¨è¾¾å¼æ¥è¯´æ˜å°±æ˜¯ ~ X = -(X + 1).è€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ koa ä¸­, length è¿”å›çš„ç»“æœä½¿ç”¨äº† ~~length è¿™æ ·çš„å½¢å¼, ä¸¤æ¬¡äºŒè¿›åˆ¶å¦è¿ç®—, è¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†å€¼å¾—å®‰å…¨è¾“å‡º, å¦‚æœ ~ è¿ç®—ç¬¦åé¢çš„å€¼\r\næ˜¯ NaN, null, ç©ºå­—ç¬¦ä¸², ç©ºæ•°ç»„, éæ•°å­—å­—ç¬¦ä¸²çš„è¯, è¿”å›å€¼ä¸º -1, è€Œå¯¹äºå°æ•°, ~ è¿ç®—ç¬¦ä¼šå‘ä¸‹å–æ•´.å…¶å®å¯¹äºå°æ•°, ~ è¿ç®—ä¼šé€‰æ‹©å¿½ç•¥å°æ•°éƒ¨åˆ†, å¯¹äºéæ•´æ•°çš„å€¼ä¼šå…ˆæ‰§è¡Œ Number ç±»å‹è½¬åŒ–.\r\næ‰€ä»¥ä¸¤æ¬¡äºŒè¿›åˆ¶å¦è¿ç®— ~~, å¯ä»¥ä½¿å°æ•°å‘ä¸‹å–æ•´, è®©éæ•´æ•°å€¼è¾“å‡ºä¸º 0(~-1 === 0).\r\n\r\n### 3. Buffer.byteLength è®¡ç®—é•¿åº¦\r\nç»†å¿ƒé˜…è¯»æºç ä¼šå‘ç°, åœ¨ koa ä¸­è®¾ç½®å“åº”çš„ length å¤´éƒ¨ä¿¡æ¯, å¹¶ä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²çš„ length å±æ€§æ¥è®¾ç½®çš„, è€Œæ˜¯é€šè¿‡ Buffer.byteLength æ–¹æ³•æ¥è®¡ç®—å¾—åˆ°çš„. ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢?\r\nHTTP Content-length å¤´éƒ¨çš„æ•°å€¼å…¶å®æ˜¯å­—èŠ‚æ•°è€Œä¸æ˜¯å­—ç¬¦æ•°, å¯¹äºæ±‰å­—æ¥è¯´, utf-8 ç¼–ç æ¨¡å¼ä¸‹ä¸€ä¸ªæ±‰å­—å­—ç¬¦éœ€è¦ 3 ä¸ªå­—èŠ‚, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²çš„ length å±æ€§æ¥èµ‹å€¼ Content-Length å¤´éƒ¨.\r\n\r\n### 4. Restful ä¸­çš„å¹‚ç­‰æ€§\r\næˆ‘ä»¬å¯ä»¥åœ¨ request å¯¹è±¡ä¸­æ‰¾åˆ°, æœ‰ idempotent å±æ€§, å®ƒç”¨äºåˆ¤æ–­è¯·æ±‚æ–¹æ³• verb æ˜¯ä¸æ˜¯å¹‚ç­‰çš„. æ‰€è°“å¹‚ç­‰æ€§, å°±æ˜¯æ— è®ºè¿™ä¸ªç›¸åŒçš„è¯·æ±‚è¯·æ±‚å¤šå°‘æ¬¡, å¾—åˆ°çš„æ•°æ®ç»“æœæ˜¯ä¸€æ ·çš„. è€Œåœ¨ HTTP çš„æ–¹æ³•ä¸­,\r\nGET, HEAD, PUT, DELETE, TRACK, OPTIONS è¯·æ±‚éƒ½æ˜¯å¹‚ç­‰çš„. å¯¹äº POST ä¸ PATCH æ–¹æ³•åˆ™æ˜¯ä¸å¹‚ç­‰çš„.\r\nè¿™é‡Œç‰¹åˆ«è®²è§£ä¸€ä¸‹ PUT çš„å«ä¹‰, PUT çš„å®šä¹‰æ˜¯ Replace(create or update), å¦‚æœå­˜åœ¨é‚£ä¹ˆå°±æ›¿æ¢, å¦‚æœä¸å­˜åœ¨é‚£ä¹ˆå°±æ–°å¢æ•°æ®.",title:"Koa æºç è§£æ",last_reply_at:"2018-04-03T03:10:38.331Z",good:!1,top:!1,reply_count:0,visit_count:20,create_at:"2018-04-03",author:{loginname:"zhangxiang958",avatar_url:"https://avatars1.githubusercontent.com/u/13307374?v=4&s=120"}},{id:"5ac2ebd10ab0448f0fe3f821",author_id:"5a6a011bafa0a121784a8fd1",tab:"ask",content:"![koa.png](//dn-cnode.qbox.me/FgeaNyEG9ZJdUDsZYFKZbywTlewu)\r\nä¸ºä»€ä¹ˆJSONçš„ä¸­æ–‡æ•°æ®ä¹±ç ã€‚",title:"koaçš„å“åº”çš„çš„JSONæ•°æ®ä¹±ç ",last_reply_at:"2018-04-03T02:49:53.954Z",good:!1,top:!1,reply_count:0,visit_count:53,create_at:"2018-04-03",author:{loginname:"TangJinJian",avatar_url:"https://avatars3.githubusercontent.com/u/30863349?v=4&s=120"}},{id:"5ac2ddea37f5d1510f57c84f",author_id:"5a12c1d2476ea1170b73398f",tab:"share",content:"åŸæ–‡ https://juejin.im/post/5ac24f976fb9a028d0439cbb\r\nkoa2 æºç åˆ†æ\r\næœ€è¿‘æƒ³åšä¸€ä¸ªå…³äºNodeJS æœåŠ¡ç«¯ç›¸å…³çš„æ€»ç»“ï¼Œæ€å‰æƒ³åè§‰å¾—å¯ä»¥ä»æºç åˆ†æä½œä¸ºåˆ‡å…¥ç‚¹ã€‚äºæ˜¯é¦–å…ˆä¾¿é€‰æ‹©äº†koa2.\r\næ³¨ï¼šç”±äºä¹¦å†™ä¹ æƒ¯åŸå›  ï¼Œä¸‹æ–‡ä¸­æ‰€æœ‰å‡ºç°koaçš„å­—çœ¼ çš†æŒ‡çš„æ˜¯koa2.xç‰ˆæœ¬ã€‚å¦‚æœæ˜¯1.xç‰ˆæœ¬åˆ™ç”¨koa1.xæ ‡æ˜ã€‚\r\né¦–å…ˆè¿›å…¥koa2 çš„æ–‡ä»¶ç›®å½• ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰åªæœ‰å››ä¸ªæ–‡ä»¶ https://github.com/koajs/koa/tree/master/lib. åˆ†åˆ«æ˜¯\r\napplication.js\r\ncontext.js\r\nrequest.js\r\nresponse.js\r\napplication.js æ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œå¯¹å¤–è¾“å‡ºä¸€ä¸ªclass ,è¿™ä¸ªclass å°±æ˜¯koa å®ä¾‹ã€‚ æºç å¦‚ä¸‹ï¼š\r\nmodule.exports = class Application extends Emitter {\r\n  /**\r\n   * Initialize a new `Application`.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.proxy = false;\r\n    this.middleware = [];\r\n    this.subdomainOffset = 2;\r\n    this.env = process.env.NODE_ENV || 'development';\r\n    this.context = Object.create(context);\r\n    this.request = Object.create(request);\r\n    this.response = Object.create(response);\r\n  }\r\n  ...\r\nå…ˆä»å¤–å±‚å‰–æ\r\né¦–å…ˆæˆ‘ä»¬å…ˆçœ‹çœ‹koa2çš„æ­£å¸¸ä½¿ç”¨é€»è¾‘ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ‰koa2è„šæ‰‹æ¶ç”Ÿæˆçš„ä¸€ä¸ªåˆå§‹åŒ–é¡¹ç›®\r\nconst Koa = require('koa')\r\nconst app = new Koa()\r\n...\r\n\r\n// middlewares\r\napp.use(bodyparser({\r\n  enableTypes:['json', 'form', 'text']\r\n}))\r\napp.use(json())\r\napp.use(logger())\r\napp.use(require('koa-static')(__dirname + '/public'))\r\n\r\napp.use(views(__dirname + '/views', {\r\n  extension: 'pug'\r\n}))\r\n\r\n// logger\r\napp.use(async (ctx, next) => {\r\n  const start = new Date()\r\n  await next()\r\n  const ms = new Date() - start\r\n  console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\r\n})\r\n\r\n// routes\r\napp.use(index.routes(), index.allowedMethods())\r\napp.use(users.routes(), users.allowedMethods())\r\n\r\n// error-handling\r\napp.on('error', (err, ctx) => {\r\n  console.error('server error', err, ctx)\r\n});\r\n\r\n\r\nvar http = require('http');\r\nvar server = http.createServer(app.callback());\r\nserver.listen(port);\r\nå¯ä»¥çœ‹åˆ°koaçš„æ ¸å¿ƒéå¸¸ç®€è¦ã€‚å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ åœ¨å®ä¾‹ä¸­ä¼ å…¥ä¸€ç³»åˆ—ä¸­é—´ä»¶ã€‚ ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œ å°†koaå®ä¾‹ä¸‹çš„å›è°ƒå‡½æ•°ä¼ å…¥å…¶ä¸­ã€‚ å³app.callback(); ç„¶åå°±å¯ä»¥å¼€å§‹ç›‘å¬æœåŠ¡äº†ã€‚ å…ˆå¯¹æ¯”ä¸€ä¸‹åŸç”Ÿhttp æœåŠ¡çš„åˆ›å»º\r\nconst http = require('http')\r\nconst server = http.createServer((req, res) => {\r\n})\r\nserver.listen(3000, () => {\r\n  console.log('server listening at 3000 port!')\r\n})\r\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å…³æ³¨åˆ°çœ‹ä¸¤ç‚¹\r\n1 koa æœåŠ¡ä¸»è¦æ˜¯åœ¨åšä¸­é—´ä»¶å¤„ç†\r\n2 koa å¯¹åŸç”Ÿhttp åˆ›å»ºæ–¹æ³•çš„å›è°ƒåšäº†å¤„ç†,åŸç”Ÿæ˜¯ (req,res) =>{ }, koa å¯¹é½åšäº†å°è£… å°è£…æˆäº† koa.callback()ã€‚\r\nè¿›å…¥application.js æŸ¥çœ‹koaå®ä¾‹\r\næ„é€ \r\næˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸­é—´ä»¶å¤„ç†å’Œå¯¹http çš„ req res è¯·æ±‚è¿”å›æµçš„å¤„ç†ã€‚ ä¸‹é¢æ¥é€ä¸€åˆ†æ application çš„æºç \r\nmodule.exports = class Application extends Emitter {\r\n  /**\r\n   * Initialize a new `Application`.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.proxy = false;// æ˜¯å¦ä¿¡ä»» proxy header å‚æ•°ï¼Œé»˜è®¤ä¸º false\r\n    this.middleware = []; //ä¿å­˜ä¸­é—´ä»¶å‡½æ•°çš„æ•°ç»„\r\n    this.subdomainOffset = 2;// ä¸æ‡‚\r\n    this.env = process.env.NODE_ENV || 'development';// ç¯å¢ƒå˜é‡\r\n    \r\n    // å°† context.js  request.js response.js åˆ†åˆ«èµ‹å€¼åˆ°è¯¥å®ä¾‹ä¸‹\r\n    this.context = Object.create(context); \r\n    this.request = Object.create(request); \r\n    this.response = Object.create(response);\r\n  }\r\n  ...\r\nlisten æ–¹æ³•\r\nlisten æ–¹æ³• æˆ‘ä»¬å¯ä»¥çœ‹åˆ° listen æ˜¯å·²ç»å°è£…å¥½äº†ä¸€ä¸ª åˆ›å»ºhttpæœåŠ¡çš„æ–¹æ³• è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸€ä¸ª è¯¥å®ä¾‹çš„å›è°ƒ å³ app.callback() ï¼Œè¿”å›ä¸€ä¸ªç›‘å¬æ–¹æ³•ã€‚æ‰€ä»¥æœåŠ¡ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡app.listen(...arg) å¯åŠ¨\r\n/**\r\n   * Shorthand for:\r\n   *\r\n   *    http.createServer(app.callback()).listen(...)\r\n   *\r\n   * @param {Mixed} ...\r\n   * @return {Server}\r\n   * @api public\r\n   */\r\n\r\n  listen(...args) {\r\n    debug('listen');\r\n    const server = http.createServer(this.callback());\r\n    return server.listen(...args);\r\n  }\r\nuse\r\næ¥ä¸‹æ¥å°±æ˜¯useæ–¹æ³• ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ ä¼ å…¥ä¸€ä¸ªä¸­é—´ä»¶æ–¹æ³• å°†ä¸­é—´ä»¶pushåˆ°this.middleware æ•°ç»„. this.middleware.push(fn); å…¶å®use æœ€å…³é”®çš„çš„å°±åªæœ‰è¿™ä¸€è¡Œä»£ç ã€‚\r\né™¤æ­¤ä¹‹å¤–ä½œè€…è¿˜æé†’æˆ‘ä»¬ï¼Œä¼ å…¥ä¸­é—´ä»¶çš„Fnä¸è¦å†™æˆgenerator å‡½æ•°ã€‚ åŸå› æ˜¯å› ä¸º koa2æ˜¯åŸºäº async await å¤„ç†å¼‚æ­¥ã€‚ async å’Œ await æ˜¯ES7 æ–°å¢çš„è¯­æ³• æœ¬è´¨æ˜¯å¯¹ generator å‡½æ•°åšçš„ä¸€å±‚å°è£… ã€‚ å®ç°äº†å¼‚æ­¥å˜åŒæ­¥çš„å†™æ³•ï¼Œ æ›´å¤Ÿæ›´æ¸…æ™°çš„åæ˜ å‡ºå‡½æ•°æ§åˆ¶æµã€‚ç›¸ä¼¼åŠŸèƒ½çš„åº“åœ¨koa1.x è¿˜æœ‰ä¸€ä¸ªco åº“ éå¸¸æœ‰åï¼Œå®ç°åŸç†ä¹Ÿå¾ˆç®€å• ä¸»è¦æ˜¯ä¸¤ç§æ–¹å¼ ç”¨thunk æˆ–è€… Promise ç»“åˆé€’å½’éƒ½å¯ä»¥å®ç°ã€‚ å¤§å®¶æ„Ÿå…´è¶£å¯ä»¥çœ‹é˜®ä¸€å³°è€å¸ˆçš„ES6æ ‡å‡† é‡Œé¢å°±æœ‰æåˆ° Generator å‡½æ•°çš„å¼‚æ­¥åº”ç”¨ ä¼ é€é—¨ã€‚\r\n/**\r\n   * Use the given middleware `fn`.\r\n   *\r\n   * Old-style middleware will be converted.\r\n   *\r\n   * @param {Function} fn\r\n   * @return {Application} self\r\n   * @api public\r\n   */\r\n\r\n  use(fn) {\r\n    if (typeof fn !== 'function') throw new TypeError('middleware must be a function!');\r\n    if (isGeneratorFunction(fn)) {\r\n      deprecate('Support for generators will be removed in v3. ' +\r\n                'See the documentation for examples of how to convert old middleware ' +\r\n                'https://github.com/koajs/koa/blob/master/docs/migration.md');\r\n      fn = convert(fn);\r\n    }\r\n    debug('use %s', fn._name || fn.name || '-');\r\n    this.middleware.push(fn);\r\n    return this;\r\n  }\r\n  \r\n\r\næ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹åˆ°äº† æœ€å…³é”®çš„callback æ–¹æ³•äº†. callback å¯¹nodeåŸç”Ÿhttpè¿”å›ä¸€ä¸ªhandler callbackã€‚ ç¬¬ä¸€è¡Œä»£ç  å°†å­˜æ”¾ä¸­é—´ä»¶å‡½æ•°çš„æ•°ç»„ this.middleware é€šè¿‡compose å‡½æ•°å¤„ç†å¾—åˆ°ä¸€ä¸ª fnã€‚\r\ncallback æ–¹æ³•\r\n/**\r\n  * Return a request handler callback\r\n  * for node's native http server.\r\n  *\r\n  * @return {Function}\r\n  * @api public\r\n  */\r\n\r\n callback() {\r\n   const fn = compose(this.middleware);\r\n\r\n   if (!this.listeners('error').length) this.on('error', this.onerror);\r\n\r\n   const handleRequest = (req, res) => {\r\n     const ctx = this.createContext(req, res);\r\n     return this.handleRequest(ctx, fn);\r\n   };\r\n\r\n   return handleRequest;\r\n }\r\ncompose å‡½æ•°\r\ncompose å‡½æ•°å‰ç«¯ç”¨è¿‡ redux çš„åŒå­¦è‚¯å®šéƒ½å¾ˆç†Ÿæ‚‰ã€‚redux é€šè¿‡composeæ¥å¤„ç† ä¸­é—´ä»¶ ã€‚ åŸç†æ˜¯ å€ŸåŠ©æ•°ç»„çš„ reduce å¯¹æ•°ç»„çš„å‚æ•°è¿›è¡Œè¿­ä»£ï¼Œè€Œæˆ‘ä»¬æ¥çœ‹çœ‹koså®ç°composeçš„æ–¹æ³•ã€‚æ„Ÿè§‰æ‰¯è¿œäº†ã€‚\r\n// redux ä¸­çš„compose å‡½æ•°\r\n\r\nexport default function compose(...funcs) {\r\n  if (funcs.length === 0) {\r\n    return arg => arg\r\n  }\r\n\r\n  if (funcs.length === 1) {\r\n    return funcs[0]\r\n  }\r\n\r\n  return funcs.reduce((a, b) => (...args) => a(b(...args)))\r\n}\r\nè¨€å½’æ­£ä¼ ï¼Œkoa å®ä¾‹ä¸­çš„composeæ˜¯ä½œä¸ºä¸€ä¸ªåŒ…å¼•å…¥çš„ ï¼Œ koa-compose æºä»£ç å¦‚ä¸‹\r\n/**\r\n * Compose `middleware` returning\r\n * a fully valid middleware comprised\r\n * of all those which are passed.\r\n *\r\n * @param {Array} middleware\r\n * @return {Function}\r\n * @api public\r\n */\r\n\r\nfunction compose (middleware) {\r\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\r\n  for (const fn of middleware) {\r\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\r\n  }\r\n\r\n  /**\r\n   * @param {Object} context\r\n   * @return {Promise}\r\n   * @api public\r\n   */\r\n\r\n  return function (context, next) {\r\n    // last called middleware #\r\n    let index = -1\r\n    return dispatch(0)\r\n    function dispatch (i) {\r\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\r\n      index = i\r\n      let fn = middleware[i]\r\n      if (i === middleware.length) fn = next\r\n      if (!fn) return Promise.resolve()\r\n      try {\r\n        return Promise.resolve(fn(context, function next () {\r\n          return dispatch(i + 1)\r\n        }))\r\n      } catch (err) {\r\n        return Promise.reject(err)\r\n      }\r\n    }\r\n  }\r\n}\r\nè¿™ä¸ªcomposeå‡½æ•° è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œ è¿™ä¸ªå‡½æ•°æ‰§è¡Œåˆ™å¯ä»¥ é€šè¿‡ä¸€ä¸ªé€’å½’å»éå†æ‰§è¡Œæ‰€æœ‰çš„ä¸­é—´ä»¶å‡½æ•°ã€‚é€šè¿‡åœ¨Promise.resolve(fn)çš„å›è°ƒä¸­æ‰§è¡Œfn å³å®ç°äº†å¯¹å¼‚æ­¥å‡½æ•°çš„å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥å…³æ³¨ä¸€ä¸‹ æœ€åˆæ˜¯æ‰§è¡Œçš„æ˜¯ dispatch(0) ä¹Ÿå°±æ˜¯this.middlewareæ•°ç»„ä¸­ä¸‹æ ‡ä¸º0çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ æœ€å…ˆè¿›å…¥çš„ä¸­é—´ä»¶å‡½æ•°ä¼šæœ€å…ˆè¢«æ‰§è¡Œ å°±åƒä¸€ä¸ªæ‰§è¡Œé˜Ÿåˆ—ã€‚\r\næ‰§è¡Œå®Œæˆä»¥å æ‰§è¡Œnext() åˆ°ä¸‹ä¸€æ­¥å¤„ç†ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†çœ‹ç¬¬ä¸€è¡Œ const fn = compose(this.middleware); ã€‚ fn å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾…æ‰§è¡Œæ‰€æœ‰ä¸­é—´ä»¶çš„æ–¹æ³• ã€‚ æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹callback()\r\ncallback() {\r\n   const fn = compose(this.middleware);\r\n\r\n   if (!this.listeners('error').length) this.on('error', this.onerror);\r\n\r\n   const handleRequest = (req, res) => {\r\n     const ctx = this.createContext(req, res);\r\n     return this.handleRequest(ctx, fn);\r\n   };\r\n\r\n   return handleRequest;\r\n }\r\né¦–å…ˆ æˆ‘ä»¬å–åˆ°äº† èƒ½å¤Ÿä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°çš„fn . callback è¿”å›ä¸€ä¸ªæ–¹æ³•ã€‚ è¿™ä¸ªæ–¹æ³•è¾“å…¥ åŸç”Ÿåˆ›å»ºhttpå‡½æ•°çš„ req,res æµ å¹¶å¯¹å…¶è¿›è¡Œå°è£…æˆä¸€ä¸ªcontext å¯¹è±¡ã€‚å¹¶è°ƒç”¨handleRequest æ–¹æ³•è¿”å› handleRequest(ctx,fn) ã€‚\r\nçœ‹åˆ°è¿™é‡Œå…¶å®å…³é”®æ­¥éª¤å°±å·²ç»å¾ˆæ¸…æ™°äº†å‰©ä¸‹åªå…³æ³¨\r\nkoa å¦‚ä½•å°†req res åŒ…è£…åˆ°ctx\r\nhandleRequest å¦‚ä½•å¤„ç†ctx å’Œ fn\r\ncreateContextæ–¹æ³•\r\ncreateContext å°†req å’Œ res åˆ†åˆ«æŒ‚è½½åˆ°context å¯¹è±¡ä¸Šã€‚\r\nconst request = context.request = Object.create(this.request);\r\n    const response = context.response = Object.create(this.response);\r\nå¹¶å¯¹req ä¸Šä¸€äº›å…³é”®çš„å±æ€§è¿›è¡Œå¤„ç†å’Œç®€åŒ– æŒ‚è½½åˆ°è¯¥å¯¹è±¡æœ¬èº«ï¼Œç®€åŒ–äº†å¯¹è¿™äº›å±æ€§çš„è°ƒç”¨ã€‚\r\n/**\r\n   * Initialize a new context.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  createContext(req, res) {\r\n    const context = Object.create(this.context);\r\n    const request = context.request = Object.create(this.request);\r\n    const response = context.response = Object.create(this.response);\r\n    context.app = request.app = response.app = this;\r\n    context.req = request.req = response.req = req;\r\n    context.res = request.res = response.res = res;\r\n    request.ctx = response.ctx = context;\r\n    request.response = response;\r\n    response.request = request;\r\n    context.originalUrl = request.originalUrl = req.url;\r\n    context.cookies = new Cookies(req, res, {\r\n      keys: this.keys,\r\n      secure: request.secure\r\n    });\r\n    request.ip = request.ips[0] || req.socket.remoteAddress || '';\r\n    context.accept = request.accept = accepts(req);\r\n    context.state = {};\r\n    return context;\r\n  }\r\nhandleRequest æ–¹æ³•\r\nhandleRequest æ–¹æ³•ç›´æ¥ä½œä¸ºç›‘å¬æˆåŠŸçš„è°ƒç”¨æ–¹æ³•ã€‚å·²ç»æ‹¿åˆ°äº† åŒ…å«req res çš„ctx å’Œ å¯ä»¥æ‰§è¡Œæ‰€æœ‰ ä¸­é—´ä»¶å‡½æ•°çš„fn. é¦–å…ˆä¸€è¿›æ¥é»˜è®¤è®¾ç½®çŠ¶æ€ç ä¸º404 . ç„¶ååˆ†åˆ«å£°æ˜äº† æˆåŠŸå‡½æ•°æ‰§è¡Œå®Œæˆä»¥åçš„æˆåŠŸ å¤±è´¥å›è°ƒæ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å®é™…ä¸Šå°±æ˜¯å†å°†ctx åˆ†åŒ–æˆreq res . åˆ†åˆ«è°ƒè¿™ä¸¤ä¸ªå¯¹è±¡å»å®¢æˆ·ç«¯æ‰§è¡Œå†…å®¹è¿”å›ã€‚ è¿˜æœ‰ä¸‰ä¸ªæ–‡ä»¶ context.js request.js response.js åˆ†åˆ«æ˜¯å°è£…äº†ä¸€äº›å¯¹ctx req res æ“ä½œç›¸å…³çš„å±æ€§ã€‚\r\n/**\r\n  * Handle request in callback.\r\n  *\r\n  * @api private\r\n  */\r\n\r\n handleRequest(ctx, fnMiddleware) {\r\n   const res = ctx.res;\r\n   res.statusCode = 404;\r\n   const onerror = err => ctx.onerror(err);\r\n   const handleResponse = () => respond(ctx);\r\n   onFinished(res, onerror);\r\n   return fnMiddleware(ctx).then(handleResponse).catch(onerror);\r\n }\r\nå¤±è´¥å›è°ƒæ‰§è¡Œ\r\n/**\r\n   * Default error handler.\r\n   *\r\n   * @param {Error} err\r\n   * @api private\r\n   */\r\n\r\n  onerror(err) {\r\n    assert(err instanceof Error, `non-error thrown: ${err}`);\r\n\r\n    if (404 == err.status || err.expose) return;\r\n    if (this.silent) return;\r\n\r\n    const msg = err.stack || err.toString();\r\n    console.error();\r\n    console.error(msg.replace(/^/gm, '  '));\r\n    console.error();\r\n  }\r\n};\r\næˆåŠŸå›è°ƒæ‰§è¡Œçš„æ–¹æ³•\r\n/**\r\n * Response helper.\r\n */\r\n\r\nfunction respond(ctx) {\r\n  // allow bypassing koa\r\n  if (false === ctx.respond) return;\r\n\r\n  const res = ctx.res;\r\n  if (!ctx.writable) return;\r\n\r\n  let body = ctx.body;\r\n  const code = ctx.status;\r\n\r\n  // ignore body\r\n  if (statuses.empty[code]) {\r\n    // strip headers\r\n    ctx.body = null;\r\n    return res.end();\r\n  }\r\n\r\n  if ('HEAD' == ctx.method) {\r\n    if (!res.headersSent && isJSON(body)) {\r\n      ctx.length = Buffer.byteLength(JSON.stringify(body));\r\n    }\r\n    return res.end();\r\n  }\r\n\r\n  // status body\r\n  if (null == body) {\r\n    body = ctx.message || String(code);\r\n    if (!res.headersSent) {\r\n      ctx.type = 'text';\r\n      ctx.length = Buffer.byteLength(body);\r\n    }\r\n    return res.end(body);\r\n  }\r\n\r\n  // responses\r\n  if (Buffer.isBuffer(body)) return res.end(body);\r\n  if ('string' == typeof body) return res.end(body);\r\n  if (body instanceof Stream) return body.pipe(res);\r\n\r\n  // body: json\r\n  body = JSON.stringify(body);\r\n  if (!res.headersSent) {\r\n    ctx.length = Buffer.byteLength(body);\r\n  }\r\n  res.end(body);\r\n}\r\nè®²åˆ°è¿™é‡Œ å…¶å®ä¸»è¦çš„ä»£ç å°±è®²å®Œäº†ã€‚å¯ä»¥çœ‹å‡º koa2 çš„æ€æƒ³éå¸¸ç®€æ´ã€‚ä¸€å¥è¯å°±æ˜¯ç”±ä¸­é—´ä»¶æ§åˆ¶æ‰€æœ‰æµç¨‹ã€‚æ‰€ä»¥è¢«å½¢è±¡çš„ç§°ä¸ºæ´‹è‘±æ¨¡å‹ã€‚åŒæ—¶è¿˜æœ‰ä¸€äº›ç‰¹è‰²å°±æ˜¯ éæ ¸å¿ƒä»£ç éƒ½å†™æˆäº†ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œè¿™æ ·ä¾¿äºç”Ÿæ€çš„å‘å±•ã€‚ è¿™ä¹Ÿæ˜¯å¦‚ä»Šå¾ˆå¤šæ¡†æ¶react vue ç­‰çš„å‘å±•çš„è¶‹åŠ¿ã€‚\r\næœ€åï¼Œæˆ‘å†™è¿™ä¸ªçš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†å­¦ä¹ ï¼Œä¸”æ·±æ„Ÿçœ‹æºç ç®€å•è¦ç†è§£çœŸæ­£çš„ç²¾é«“è¿˜æ˜¯å¾ˆéš¾å¾ˆéš¾ã€‚ä¸”å­¦ä¸”çæƒœå§ å“ˆå“ˆ ğŸ˜‰",title:"æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†ækoa2çš„æºç ğŸ™‚",last_reply_at:"2018-04-03T02:28:07.063Z",good:!1,top:!1,reply_count:1,visit_count:61,create_at:"2018-04-03",author:{loginname:"yangfan0095",avatar_url:"https://avatars2.githubusercontent.com/u/21197847?v=4&s=120"}},{id:"5ac073b852d7d3a8698a49f4",author_id:"57abe0de476898b472247de2",tab:"share",content:'ç›®å‰æ­£åœ¨ç¿»è¯‘ä¸­æ–‡æ–‡æ¡£ï¼ŒæœŸå¾…å¤§å®¶çš„ä¸€èµ·å‚ä¸ï¼š\r\n\r\n[typeormä¸­æ–‡æ–‡æ¡£ ](https://github.com/huanz/typeorm.github.io)\r\n\r\nä¸­æ–‡æ–‡æ¡£åœ°å€ï¼š[http://typeorm.noonme.com/](http://typeorm.noonme.com/)\r\n\r\n\r\n\r\n[![TypeORM](https://github.com/typeorm/typeorm/raw/master/resources/logo_big.png)](http://typeorm.io/)\r\n\r\nTypeORMæ˜¯ä¸€ä¸ª[ORM](https://en.wikipedia.org/wiki/Object-relational_mapping)æ¡†æ¶ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨NodeJSã€æµè§ˆå™¨ã€Cordovaã€PhoneGapå’ŒIonicå¹³å°ä¸Šï¼Œå¯ä»¥ä¸TypeScriptå’ŒJavaScript (ES5, ES6, ES7)ä¸€èµ·ä½¿ç”¨ã€‚\r\nå®ƒçš„ç›®æ ‡æ˜¯å§‹ç»ˆæ”¯æŒæœ€æ–°çš„JavaScriptç‰¹æ€§å¹¶æä¾›é¢å¤–çš„ç‰¹æ€§ä»¥å¸®åŠ©ä½ å¼€å‘ä»»ä½•ä½¿ç”¨æ•°æ®åº“çš„åº”ç”¨ç¨‹åº â€”â€” ä¸ç®¡æ˜¯åªæœ‰å‡ å¼ è¡¨çš„å°å‹åº”ç”¨è¿˜æ˜¯æ‹¥æœ‰å¤šæ•°æ®åº“çš„å¤§å‹ä¼ä¸šåº”ç”¨ã€‚\r\n\r\nä¸åŒäºç°æœ‰çš„æ‰€æœ‰å…¶ä»–JavaScript ORMæ¡†æ¶ï¼ŒTypeORMæ”¯æŒActive Recordå’ŒData Mapperæ¨¡å¼ï¼Œè¿™æ„å‘³ç€ä½ ç”¨æœ€æœ‰æ•ˆçš„æ–¹æ³•ç¼–å†™é«˜è´¨é‡çš„ã€æ¾è€¦åˆçš„ã€å¯æ‰©å±•çš„ã€å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚\r\n\r\nTypeORMå—åˆ°äº†å‚è€ƒäº†å¾ˆå¤šå…¶ä»–ä¼˜ç§€ORMçš„å®ç°, æ¯”å¦‚ [Hibernate](http://hibernate.org/orm/), [Doctrine](http://www.doctrine-project.org/) å’Œ [Entity Framework](https://www.asp.net/entity-framework).\r\n\r\nTypeORM çš„ä¸€äº›ç‰¹æ€§ï¼š\r\n- æ”¯æŒActive Recordå’ŒData Mapperï¼ˆä½ å¯ä»¥è‡ªç”±é€‰æ‹©ï¼‰\r\n- å®ä½“å’Œåˆ—\r\n- æ•°æ®åº“ç‰¹æ€§åˆ—ç±»å‹\r\n- å®ä½“ç®¡ç†\r\n- å­˜å‚¨åº“å’Œè‡ªå®šä¹‰å­˜å‚¨\båº“\r\n- æ¸…æ´å¯¹è±¡å…³ç³»æ¨¡å‹\r\n- å…³è”ï¼ˆå…³ç³»ï¼‰\r\n- è´ªå©ªå’Œå»¶è¿Ÿå…³ç³»\r\n- å•å‘çš„ï¼ŒåŒå‘çš„å’Œè‡ªå¼•ç”¨çš„å…³ç³»\r\n- æ”¯æŒå¤šé‡ç»§æ‰¿æ¨¡å¼\r\n- çº§è”\r\n- ç´¢å¼•\r\n- äº‹åŠ¡\r\n- è¿ç§»å’Œè‡ªåŠ¨è¿ç§»\r\n- è¿æ¥æ± \r\n- å¤åˆ¶\r\n- ä½¿ç”¨å¤šä¸ªæ•°æ®åº“è¿æ¥\r\n- ä½¿ç”¨å¤šä¸ªæ•°æ®åº“ç±»å‹\r\n- è·¨æ•°æ®åº“å’Œè·¨æ¨¡å¼æŸ¥è¯¢\r\n- ä¼˜é›…çš„è¯­æ³•ï¼Œçµæ´»è€Œå¼ºå¤§çš„QueryBuilder\r\n- å·¦è”æ¥å’Œå†…è”æ¥\r\n- å‡†ç¡®çš„åˆ†é¡µè¿æ¥æŸ¥è¯¢\r\n- æŸ¥è¯¢ç¼“å­˜\r\n- åŸå§‹ç»“æœæµ\r\n- æ—¥å¿—\r\n- ç›‘å¬è€…å’Œè®¢é˜…è€…ï¼ˆé’©å­ï¼‰\r\n- æ”¯æŒé—­åŒ…è¡¨æ¨¡å¼\r\n- åœ¨æ¨¡å‹æˆ–è€…åˆ†ç¦»çš„é…ç½®æ–‡ä»¶ä¸­å£°æ˜æ¨¡å¼\r\n- json / xml / yml / envæ ¼å¼çš„è¿æ¥é…ç½®\r\n- æ”¯æŒ MySQL / MariaDB / Postgres / SQLite / Microsoft SQL Server / Oracle / WebSQL / sql.js\r\n- æ”¯æŒ MongoDB NoSQL æ•°æ®åº“\r\n- åœ¨NodeJS / æµè§ˆå™¨ / Ionic / Cordova / Electronå¹³å°ä¸Šå·¥ä½œ\r\n- æ”¯æŒ TypeScript å’Œ JavaScript\r\n- äº§ç”Ÿå‡ºé«˜æ€§èƒ½ã€çµæ´»ã€æ¸…æ´å’Œå¯ç»´æŠ¤çš„ä»£ç \r\n- éµå¾ªæ‰€æœ‰å¯èƒ½çš„æœ€ä½³å®è·µ\r\n- å‘½ä»¤è¡Œå·¥å…·\r\n\r\nè¿˜æœ‰æ›´å¤š...\r\n\r\nä½¿ç”¨TypeORMä½ çš„æ¨¡å‹æ˜¯è¿™æ ·çš„ï¼š\r\n\r\n```typescript\r\nimport {Entity, PrimaryGeneratedColumn, Column} from "typeorm";\r\n\r\n@Entity()\r\nexport class User {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    firstName: string;\r\n\r\n    @Column()\r\n    lastName: string;\r\n\r\n    @Column()\r\n    age: number;\r\n\r\n}\r\n```\r\n\r\nä½ çš„åŸŸé€»è¾‘æ˜¯è¿™æ ·çš„ï¼š\r\n\r\n```typescript\r\nconst user = new User();\r\nuser.firstName = "Timber";\r\nuser.lastName = "Saw";\r\nuser.age = 25;\r\nawait repository.save(user);\r\n\r\nconst allUsers = await repository.find();\r\nconst firstUser = await repository.findOneById(1);\r\nconst timber = await repository.findOne({ firstName: "Timber", lastName: "Saw" });\r\n\r\nawait repository.remove(timber);\r\n```\r\n\r\næˆ–è€…ï¼Œä½ å¦‚æœä½ å–œæ¬¢ä½¿ç”¨â€œActiveRecordâ€å®ç°ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒï¼š\r\n\r\n```typescript\r\nimport {Entity, PrimaryGeneratedColumn, Column, BaseEntity} from "typeorm";\r\n\r\n@Entity()\r\nexport class User extends BaseEntity {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    firstName: string;\r\n\r\n    @Column()\r\n    lastName: string;\r\n\r\n    @Column()\r\n    age: number;\r\n\r\n}\r\n```\r\n\r\nä½ çš„åŸŸé€»è¾‘æ˜¯è¿™æ ·çš„ï¼š\r\n\r\n```typescript\r\nconst user = new User();\r\nuser.firstName = "Timber";\r\nuser.lastName = "Saw";\r\nuser.age = 25;\r\nawait user.save();\r\n\r\nconst allUsers = await User.find();\r\nconst firstUser = await User.findOneById(1);\r\nconst timber = await User.findOne({ firstName: "Timber", lastName: "Saw" });\r\n\r\nawait timber.remove();\r\n```\r\n\r\n## è¯·æ³¨æ„\r\n\r\nè¿™ä¸ªæ–‡æ¡£å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚ \r\nå¯ä»¥å»[å®˜ç½‘](http://typeorm.io)æŸ¥çœ‹æœ€æ–°çš„è‹±æ–‡æ–‡æ¡£ã€‚\r\néå¸¸æ¬¢è¿ä½ çš„è´¡çŒ®ã€‚\r\n\r\n## å®‰è£…\r\n\r\n1. å®‰è£…TypeORM:\r\n\r\n    `npm install typeorm --save`\r\n\r\n2. éœ€è¦å®‰è£…ä¾èµ–æ¨¡å— `reflect-metadata` :\r\n\r\n    `npm install reflect-metadata --save`\r\n\r\n    åœ¨åº”ç”¨é‡Œå…¨å±€å¼•ç”¨ä¸€ä¸‹:\r\n\r\n    * æ¯”å¦‚åœ¨app.tsçš„å…¥å£å¤„ `require("reflect-metadata")` \r\n\r\n3. ä½ å¯èƒ½éœ€è¦å®‰è£…nodeç±»å‹ï¼š\r\n\r\n    `npm install @types/node --save`\r\n\r\n4. å®‰è£…æ•°æ®åº“é©±åŠ¨:\r\n\r\n    * **MySQL** æˆ– **MariaDB**\r\n    \r\n        `npm install mysql --save`\r\n    \r\n    * **PostgreSQL**\r\n    \r\n        `npm install pg --save`\r\n    \r\n    * **SQLite**\r\n    \r\n        `npm install sqlite3 --save`\r\n    \r\n    * **Microsoft SQL Server**\r\n    \r\n        `npm install mssql --save`\r\n\r\n    * **sql.js**\r\n\r\n        `npm install sql.js --save`\r\n    \r\n    * **Oracle** (experimental)\r\n    \r\n        `npm install oracledb --save`\r\n    \r\n    å¯ä»¥æ ¹æ®ä½ çš„æ•°æ®åº“é€‰æ‹©å®‰è£…ä¸Šé¢çš„ä»»æ„ä¸€ä¸ª.\r\n    \r\n    ä½¿ç”¨oracleé©±åŠ¨éœ€è¦å‚è€ƒå®‰è£…è¯´æ˜ï¼š[åœ°å€](https://github.com/oracle/node-oracledb).\r\n\r\n#### TypeScripté…ç½®\r\n\r\nç¡®ä¿ä½ çš„TypeScriptç¼–è¯‘å™¨çš„ç‰ˆæœ¬å¤§äº**2.3**ï¼Œå¹¶ä¸”åœ¨`tsconfig.json`å¼€å¯ä¸‹é¢è®¾ç½®:\r\n\r\n```json\r\n"emitDecoratorMetadata": true,\r\n"experimentalDecorators": true,\r\n```\r\n\r\nåŒæ—¶éœ€è¦å¼€å¯ç¼–è¯‘é€‰é¡¹é‡Œçš„`lib`ä¸‹çš„`es6`æˆ–è€…ä»`@typings`å®‰è£…`es6-shim`\r\n\r\n## å¿«é€Ÿå¼€å§‹\r\n\r\nå¼€å§‹ä½¿ç”¨TypeORMçš„æœ€å¿«æ–¹æ³•æ˜¯ä½¿ç”¨å®ƒçš„CLIå‘½ä»¤ç”Ÿæˆä¸€ä¸ªåˆå§‹é¡¹ç›®ã€‚\r\nå¿«é€Ÿå¼€å§‹åªæœ‰åœ¨NodeJSåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨TypeORMæ‰å¯ä»¥ä½¿ç”¨ã€‚\r\nå¦‚æœä½ æ­£åœ¨ä½¿ç”¨å…¶ä»–å¹³å°ï¼Œè¯·çœ‹[åˆ†æ­¥æŒ‡å—](#åˆ†æ­¥æŒ‡å—)ã€‚\r\n\r\né¦–å…ˆå…¨å±€å®‰è£…TypeORMï¼š\r\n\r\n```\r\nnpm install typeorm -g\r\n```\r\n\r\nç„¶åè½¬åˆ°æ–°é¡¹ç›®çš„ç›®å½•å¹¶è¿è¡Œè¯¥å‘½ä»¤ï¼š\r\n\r\n```\r\ntypeorm init --name MyProject --database mysql\r\n```\r\n\r\n`name`å³é¡¹ç›®çš„åç§°ï¼Œ`database`æ˜¯ä½ å°†ä½¿ç”¨çš„æ•°æ®åº“ã€‚æ•°æ®åº“å¯ä»¥æ˜¯ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š`mysql`ã€`mariadb`ã€`postgres`ã€`sqlite`ã€`mssql`ã€`oracle`ï¼Œ`websql`ã€`mongodb`ã€‚\r\n\r\nè¯¥å‘½ä»¤å°†åœ¨`MyProject`ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š\r\n\r\n```\r\nMyProject\r\nâ”œâ”€â”€ src              // æ”¾ä½ çš„ TypeScript ä»£ç \r\nâ”‚   â”œâ”€â”€ entity       // æ”¾å®ä½“ï¼ˆæ•°æ®åº“æ¨¡å‹ï¼‰çš„ç›®å½•\r\nâ”‚   â”‚   â””â”€â”€ User.ts  // å®ä½“çš„æ¡ˆä¾‹\r\nâ”‚   â”œâ”€â”€ migration    // è¿ç§»æ–‡ä»¶ç›®å½•\r\nâ”‚   â””â”€â”€ index.ts     // åº”ç”¨ç¨‹åºå…¥å£\r\nâ”œâ”€â”€ .gitignore       // æ ‡å‡†gitå¿½ç•¥æ–‡ä»¶\r\nâ”œâ”€â”€ ormconfig.json   // ORMå’Œæ•°æ®è¿æ¥é…ç½®\r\nâ”œâ”€â”€ package.json     // nodeæ¨¡å—ä¾èµ–\r\nâ”œâ”€â”€ README.md        // ç®€å•çš„è¯´æ˜æ–‡ä»¶\r\nâ””â”€â”€ tsconfig.json    // TypeScriptç¼–è¯‘é…ç½®\r\n```\r\n\r\n> ä½ ä¹Ÿå¯ä»¥åœ¨ç°æœ‰çš„nodeé¡¹ç›®ç›®å½•æ‰§è¡Œ`typeorm init`ï¼Œä½†æ˜¯ä¸€å®šè¦å°å¿ƒ - å®ƒå¯èƒ½ä¼šè¦†ç›–ä½ å·²ç»æœ‰çš„ä¸€äº›æ–‡ä»¶ã€‚\r\n\r\nä¸‹ä¸€æ­¥æ˜¯å®‰è£…é¡¹ç›®ä¾èµ–\r\n\r\n```\r\ncd MyProject\r\nnpm install\r\n```\r\n\r\nåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¿®æ”¹ `ormconfig.json` æ–‡ä»¶å°†è‡ªå·±çš„æ•°æ®åº“è¿æ¥é…ç½®é€‰é¡¹æ”¾åœ¨å…¶ä¸­ï¼š\r\n\r\n```json\r\n{\r\n   "type": "mysql",\r\n   "host": "localhost",\r\n   "port": 3306,\r\n   "username": "test",\r\n   "password": "test",\r\n   "database": "test",\r\n   "synchronize": true,\r\n   "logging": false,\r\n   "entities": [\r\n      "src/entity/**/*.ts"\r\n   ],\r\n   "migrations": [\r\n      "src/migration/**/*.ts"\r\n   ],\r\n   "subscribers": [\r\n      "src/subscriber/**/*.ts"\r\n   ]\r\n}\r\n```\r\n\r\né€šå¸¸æ¥è¯´ï¼Œå¤§å¤šæ•°æ—¶å€™ä½ åªéœ€è¦é…ç½®`host`ï¼Œ`username`ï¼Œ`password`ï¼Œ`database` æˆ–è€… `port` é€‰é¡¹ã€‚\r\n\r\né…ç½®å’Œæ¨¡å—å®‰è£…éƒ½å®Œæˆä¹‹åï¼Œå°±å¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åºäº†ï¼š\r\n\r\n```\r\nnpm start\r\n```\r\n\r\nå°±æ˜¯è¿™æ ·ï¼Œä½ çš„åº”ç”¨ç¨‹åºåº”è¯¥æˆåŠŸåœ°è¿è¡Œå¹¶å°†ä¸€ä¸ªæ–°ç”¨æˆ·æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚\r\nä½ å¯ä»¥ç»§ç»­è¿™ä¸ªé¡¹ç›®ï¼Œé›†æˆä½ éœ€è¦çš„å…¶ä»–æ¨¡å—ï¼Œå¹¶åˆ›å»ºæ›´å¤šçš„å®ä½“ã€‚\r\n\r\n> è¿è¡Œ`typeorm init --name MyProject --database mysql --express`å‘½ä»¤å¯ä»¥å®‰è£…`express`ï¼Œç”Ÿæˆä¸€ä¸ªæ›´é«˜çº§çš„é¡¹ç›®ã€‚\r\n\r\n## åˆ†æ­¥æŒ‡å—\r\n\r\nä½ å¯¹ORMçš„æœŸæœ›æ˜¯ä»€ä¹ˆï¼Ÿ\r\né¦–å…ˆï¼Œä½ é¢„æœŸå®ƒå°†ä¸ºä½ åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œå¹¶æŸ¥æ‰¾/æ’å…¥/æ›´æ–°/åˆ é™¤ä½ çš„æ•°æ®ï¼Œè€Œä¸å¿…ç¼–å†™å¤§é‡éš¾ä»¥ç»´æŠ¤çš„SQLæŸ¥è¯¢ã€‚\r\næœ¬æŒ‡å—å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä»å¤´å¼€å§‹è®¾ç½®TypeORMï¼Œå¹¶è®©å®ƒæŒ‰ç…§ä½ æ‰€æœŸæœ›çš„ORMè¿›è¡Œã€‚\r\n\r\n### åˆ›å»ºæ¨¡å‹\r\n\r\nä¸æ•°æ®åº“ä¸€èµ·å·¥ä½œä»åˆ›å»ºè¡¨å¼€å§‹ã€‚\r\nå¦‚ä½•å‘Šè¯‰TypeORMåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Ÿ\r\nç­”æ¡ˆæ˜¯ - é€šè¿‡æ¨¡å‹ã€‚\r\nä½ çš„åº”ç”¨ç¨‹åºä¸­çš„æ¨¡å‹å°±æ˜¯ä½ çš„æ•°æ®åº“ä¸­çš„è¡¨ã€‚\r\n\r\nä¾‹å¦‚ä½ æœ‰ä¸€ä¸ª `Photo` æ¨¡å‹ï¼š\r\n\r\n```typescript\r\nexport class Photo {\r\n    id: number;\r\n    name: string;\r\n    description: string;\r\n    filename: string;\r\n    views: number;\r\n}\r\n```\r\n\r\nä½ æƒ³åœ¨ä½ çš„æ•°æ®åº“ä¸­å­˜å‚¨ç…§ç‰‡ã€‚\r\nè¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ä¸œè¥¿ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Œå¹¶ä»æ¨¡å‹åˆ›å»ºæ•°æ®åº“è¡¨ã€‚\r\nä¸æ˜¯æ‰€æœ‰çš„æ¨¡å‹ï¼Œè€Œä»…ä»…æ˜¯é‚£äº›ä½ å®šä¹‰ä¸º*å®ä½“*ã€‚\r\n\r\n### åˆ›å»ºå®ä½“\r\n\r\n*å®ä½“*æ˜¯ä½ ç”¨ `@Entity` è£…é¥°çš„æ¨¡å‹ã€‚\r\nå°†ä¸ºè¿™äº›æ¨¡å‹åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚\r\nä½¿ç”¨TypeORMä½ å°†åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ä½“ã€‚\r\nä½ å¯ä»¥ä½¿ç”¨ä»–ä»¬åŠ è½½/æ’å…¥/æ›´æ–°/åˆ é™¤å¹¶æ‰§è¡Œå…¶ä»–æ“ä½œã€‚\r\n\r\nè®©æˆ‘ä»¬æŠŠ`Photo`æ¨¡å‹å˜æˆä¸€ä¸ªå®ä½“ï¼š\r\n\r\n```typescript\r\nimport {Entity} from "typeorm";\r\n\r\n@Entity()\r\nexport class Photo {\r\n    id: number;\r\n    name: string;\r\n    description: string;\r\n    filename: string;\r\n    views: number;\r\n    isPublished: boolean;\r\n}\r\n```\r\n\r\nç°åœ¨ï¼Œå°†ä¼šä¸º `Photo` å®ä½“åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒã€‚\r\næˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Œç„¶è€Œæ²¡æœ‰åˆ—çš„è¡¨ç¤ºä¸å­˜åœ¨çš„ã€‚\r\nè®©æˆ‘ä»¬åœ¨æ•°æ®åº“è¡¨ä¸­åˆ›å»ºä¸€äº›åˆ—å§ã€‚\r\n\r\n### æ·»åŠ æ•°æ®åº“è¡¨åˆ—\r\n\r\nè¦æ·»åŠ æ•°æ®åº“åˆ—ï¼Œåªéœ€è¦å°†ç”Ÿæˆçš„å®ä½“çš„å±æ€§ç”¨ `@Column` è£…é¥°ã€‚\r\n\r\n```typescript\r\nimport {Entity, Column} from "typeorm";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    @Column()\r\n    id: number;\r\n\r\n    @Column()\r\n    name: string;\r\n\r\n    @Column()\r\n    description: string;\r\n\r\n    @Column()\r\n    filename: string;\r\n\r\n    @Column()\r\n    views: number;\r\n\r\n    @Column()\r\n    isPublished: boolean;\r\n}\r\n```\r\n\r\nç°åœ¨ `id`ï¼Œ`name`ï¼Œ`description`ï¼Œ`filename`ï¼Œ`views` å’Œ `isPublished` åˆ—å°†ä¼šè¢«æ·»åŠ  `photo` è¡¨ã€‚\r\næ•°æ®åº“ä¸­çš„åˆ—ç±»å‹æ˜¯ä»ä½ ä½¿ç”¨çš„å±æ€§ç±»å‹æ¨æ–­å‡ºæ¥çš„ï¼Œä¾‹å¦‚ï¼š`number` å°†ä¼šè¢«è½¬æˆ `integer`ï¼Œ`string` è½¬ä¸º `varchar`ï¼Œ`boolean` è½¬ä¸º `bool`ï¼Œç­‰ã€‚\r\nä½†æ˜¯ä½ å¯ä»¥é€šè¿‡éšå¼åœ¨ `@Column` è£…é¥°å™¨ä¼ å…¥ç±»å‹å°†åˆ—ç±»å‹æŒ‡å®šä¸ºä»»ä½•ä½ æ•°æ®åº“æ”¯æŒçš„ç±»å‹ã€‚\r\n\r\næˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªå¸¦æœ‰åˆ—çš„æ•°æ®åº“è¡¨ï¼Œä½†æ˜¯è¿˜å‰©ä¸‹ä¸€ä»¶äº‹ã€‚\r\næ¯ä¸ªæ•°æ®åº“è¡¨å¿…é¡»æœ‰ä¸€ä¸ªå¸¦æœ‰ä¸»é”®çš„åˆ—ã€‚\r\n\r\n### åˆ›å»ºä¸€ä¸ªä¸»é”®åˆ—\r\n\r\næ¯ä¸ªè¡¨éƒ½**å¿…é¡»**è‡³å°‘æœ‰ä¸€ä¸ªä¸»é”®åˆ—ã€‚è¿™æ˜¯ä¸€ä¸ªè¦æ±‚ï¼Œä½ ä¸èƒ½é¿å…ã€‚è¦ä½¿åˆ—æˆä¸ºä¸»é”®ï¼Œä½ éœ€è¦ä½¿ç”¨ `@PrimaryColumn` ä¿®é¥°ç¬¦ã€‚\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryColumn} from "typeorm";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    @PrimaryColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    name: string;\r\n\r\n    @Column()\r\n    description: string;\r\n\r\n    @Column()\r\n    filename: string;\r\n\r\n    @Column()\r\n    views: number;\r\n\r\n    @Column()\r\n    isPublished: boolean;\r\n}\r\n```\r\n\r\n### åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„åˆ—\r\n\r\nç°åœ¨ï¼Œå‡è®¾ä½ å¸Œæœ›å°†idåˆ—è‡ªåŠ¨ç”Ÿæˆ(è¿™å°±æ˜¯æ‰€è°“çš„è‡ªåŠ¨é€’å¢/æŒ‰é¡ºåº/è¿ç»­çš„/ç”Ÿæˆå”¯ä¸€æ ‡è¯†åˆ—)ã€‚\r\nè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦å°† `@PrimaryColumn` ä¿®é¥°ç¬¦æ›´æ”¹ä¸º `@PrimaryGeneratedColumn` ä¿®é¥°ç¬¦ï¼š\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn} from "typeorm";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    name: string;\r\n\r\n    @Column()\r\n    description: string;\r\n\r\n    @Column()\r\n    filename: string;\r\n\r\n    @Column()\r\n    views: number;\r\n\r\n    @Column()\r\n    isPublished: boolean;\r\n}\r\n```\r\n\r\n### åˆ—æ•°æ®ç±»å‹\r\n\r\næ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¿®å¤æ•°æ®ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²è¢«æ˜ å°„åˆ°ä¸€ä¸ªvarchar(255)ç±»å‹ï¼ˆå–å†³äºæ•°æ®åº“ç±»å‹ï¼‰ã€‚\r\næ•°å­—è¢«æ˜ å°„åˆ°ä¸€ä¸ªintegerç±»å‹ï¼ˆå–å†³äºæ•°æ®åº“ç±»å‹ï¼‰ã€‚\r\næˆ‘ä»¬ä¸å¸Œæœ›æ‰€æœ‰çš„åˆ—éƒ½æ˜¯æœ‰é™çš„varcharsæˆ–æ•´æ•°ã€‚\r\nè®©æˆ‘ä»¬è®¾ç½®æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼š\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn} from "typeorm";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column({\r\n        length: 100\r\n    })\r\n    name: string;\r\n\r\n    @Column("text")\r\n    description: string;\r\n\r\n    @Column()\r\n    filename: string;\r\n\r\n    @Column("double")\r\n    views: number;\r\n\r\n    @Column()\r\n    isPublished: boolean;\r\n}\r\n```\r\n\r\nåˆ—ç±»å‹å–å†³äºæ•°æ®åº“æ”¯æŒçš„ç±»å‹ã€‚\r\nå¯ä»¥è®¾ç½®æ•°æ®åº“æ”¯æŒçš„ä»»ä½•åˆ—ç±»å‹ã€‚\r\næ›´å¤šå…³äºæ”¯æŒçš„åˆ—ç±»å‹ä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[è¿™é‡Œ](./docs/entity.md#column-types)ã€‚\r\n\r\n### åˆ›å»ºæ•°æ®åº“è¿æ¥\r\n\r\nç°åœ¨å®ä½“å·²ç»æœ‰äº†ï¼Œè®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ª `index.ts` ï¼ˆæˆ– `app.ts` ä¸ç®¡ä½ å«å®ƒä»€ä¹ˆï¼‰çš„æ–‡ä»¶ï¼Œå¹¶é…ç½®æ•°æ®åº“è¿æ¥ï¼š\r\n\r\n```typescript\r\nimport "reflect-metadata";\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection({\r\n    type: "mysql",\r\n    host: "localhost",\r\n    port: 3306,\r\n    username: "root",\r\n    password: "admin",\r\n    database: "test",\r\n    entities: [\r\n        Photo\r\n    ],\r\n    synchronize: true,\r\n    logging: false\r\n}).then(connection => {\r\n    // è¿™é‡Œå¯ä»¥å†™å®ä½“æ“ä½œç›¸å…³çš„ä»£ç  \r\n}).catch(error => console.log(error));\r\n```\r\n\r\nåœ¨ä¾‹å­é‡Œä½¿ç”¨çš„æ˜¯mysqlï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–æ•°æ®åº“ï¼Œåªéœ€è¦ç®€å•ä¿®æ”¹driveré€‰é¡¹é‡Œçš„æ•°æ®åº“çš„ç±»å‹å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š \r\nmysql, mariadb, postgres, sqlite, mssql or oracle.\r\nåŒæ ·å¯ä»¥ä¿®æ”¹host, port, username, password ä»¥åŠdatabaseç­‰è®¾ç½®.\r\n\r\næŠŠPhotoå®ä½“åŠ åˆ°æ•°æ®è¿æ¥çš„å®ä½“åˆ—è¡¨ä¸­ï¼Œæ‰€æœ‰éœ€è¦åœ¨è¿™ä¸ªè¿æ¥ä¸‹ä½¿ç”¨çš„å®ä½“éƒ½å¿…é¡»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚\r\n\r\n`synchronize`é€‰é¡¹å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶ç¡®ä¿ä½ çš„å®ä½“å’Œæ•°æ®åº“ä¿æŒåŒæ­¥ã€‚ \r\n\r\n### å¼•ç”¨ç›®å½•ä¸‹çš„æ‰€æœ‰å®ä½“\r\n\r\næ¥ä¸‹æ¥æˆ‘ä»¬å¯èƒ½ä¼šåˆ›å»ºæ›´å¤šçš„å®ä½“å¹¶æŠŠå®ƒä»¬ä¸€ä¸€åŠ åˆ°é…ç½®å½“ä¸­ã€‚\r\nä¸è¿‡è¿™æ ·ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¥½åœ¨å¯ä»¥ç›´æ¥å†™ä¸Šå®ä½“çš„ç›®å½•ï¼Œè¿™æ ·è¿™ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰å®ä½“éƒ½å¯ä»¥åœ¨å½“å‰è¿æ¥ä¸­è¢«ä½¿ç”¨ï¼š\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\n\r\ncreateConnection({\r\n    driver: {\r\n        type: "mysql",\r\n        host: "localhost",\r\n        port: 3306,\r\n        username: "root",\r\n        password: "admin",\r\n        database: "test"\r\n    },\r\n    entities: [\r\n        __dirname + "/entity/*.js"\r\n    ],\r\n    synchronize: true,\r\n}).then(connection => {\r\n    // here you can start to work with your entities\r\n}).catch(error => console.log(error));\r\n```\r\n\r\n### å¯åŠ¨åº”ç”¨\r\n\r\nç°åœ¨å¯ä»¥å¯åŠ¨`app.ts`ï¼Œå¯åŠ¨åå¯ä»¥å‘ç°æ•°æ®åº“è‡ªåŠ¨è¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”Photoè¿™ä¸ªè¡¨ä¹Ÿä¼šåˆ›å»ºå‡ºæ¥ã€‚\r\n\r\n```shell\r\n+-------------+--------------+----------------------------+\r\n|                         photo                           |\r\n+-------------+--------------+----------------------------+\r\n| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |\r\n| name        | varchar(500) |                            |\r\n| description | text         |                            |\r\n| filename    | varchar(255) |                            |\r\n| views       | int(11)      |                            |\r\n| isPublished | boolean      |                            |\r\n+-------------+--------------+----------------------------+\r\n```\r\n\r\n### æ·»åŠ å’Œæ’å…¥photo\r\n\r\nç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„photoç„¶åå­˜åˆ°æ•°æ®åº“ï¼š\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\n\r\ncreateConnection(/*...*/).then(connection => {\r\n\r\n    let photo = new Photo();\r\n    photo.name = "Me and Bears";\r\n    photo.description = "I am near polar bears";\r\n    photo.filename = "photo-with-bears.jpg";\r\n    photo.views = 1;\r\n    photo.isPublished = true;\r\n\r\n    connection.manager\r\n            .save(photo)\r\n            .then(photo => {\r\n                console.log("Photo has been saved");\r\n            });\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n  \r\n### ä½¿ç”¨async/awaitè¯­æ³•\r\n\r\nç°åœ¨åˆ©ç”¨TypeScriptçš„async/awaitè¯­æ³•æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ï¼š\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    let photo = new Photo();\r\n    photo.name = "Me and Bears";\r\n    photo.description = "I am near polar bears";\r\n    photo.filename = "photo-with-bears.jpg";\r\n    photo.views = 1;\r\n    photo.isPublished = true;\r\n\r\n    await connection.manager.save(photo);\r\n    console.log("Photo has been saved");\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n\r\n### ä½¿ç”¨EntityManager\r\n\r\nåˆšåˆšæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„photoå¹¶ä¸”å­˜è¿›æ•°æ®åº“ã€‚ä½¿ç”¨EntityManagerå¯ä»¥æ“ä½œå®ä½“ï¼Œç°åœ¨ç”¨`EntityManager`æ¥æŠŠphotoä»æ•°æ®åº“ä¸­å–å‡ºæ¥ã€‚\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let savedPhotos = await connection.manager.find(Photo);\r\n    console.log("All photos from the db: ", savedPhotos);\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n\r\nsavedPhotos ä¼šä»æ•°æ®åº“ä¸­å–åˆ°çš„æ˜¯ä¸€ä¸ªPhotoå¯¹è±¡çš„æ•°ç»„\r\n\r\n### ä½¿ç”¨Repositories\r\n\r\nç°åœ¨é‡æ„ä¸‹ä»£ç ï¼Œä½¿ç”¨`Repository`æ¥ä»£æ›¿EntityManageã€‚æ¯ä¸ªå®ä½“éƒ½æœ‰è‡ªå·±çš„repositoryï¼Œå¯ä»¥å¯¹è¿™ä¸ªå®ä½“è¿›è¡Œä»»ä½•æ“ä½œã€‚\r\nå¦‚æœè¦å¯¹å®ä½“åšå¾ˆå¤šæ“ä½œï¼ŒRepositoriesä¼šæ¯”EntityManageræ›´åŠ æ–¹ä¾¿ã€‚\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    let photo = new Photo();\r\n    photo.name = "Me and Bears";\r\n    photo.description = "I am near polar bears";\r\n    photo.filename = "photo-with-bears.jpg";\r\n    photo.views = 1;\r\n    photo.isPublished = true;\r\n\r\n    let photoRepository = connection.getRepository(Photo);\r\n\r\n    await photoRepository.save(photo);\r\n    console.log("Photo has been saved");\r\n\r\n    let savedPhotos = await photoRepository.find();\r\n    console.log("All photos from the db: ", savedPhotos);\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n \r\n### ä»æ•°æ®åº“ä¸­å–photos\r\n\r\nç°åœ¨æ¥å°è¯•ç”¨Repositoryåšä¸€äº›å–æ•°æ®æ–¹é¢çš„æ“ä½œ:\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let allPhotos = await photoRepository.find();\r\n    console.log("All photos from the db: ", allPhotos);\r\n\r\n    let firstPhoto = await photoRepository.findOneById(1);\r\n    console.log("First photo from the db: ", firstPhoto);\r\n\r\n    let meAndBearsPhoto = await photoRepository.findOne({ name: "Me and Bears" });\r\n    console.log("Me and Bears photo from the db: ", meAndBearsPhoto);\r\n\r\n    let allViewedPhotos = await photoRepository.find({ views: 1 });\r\n    console.log("All viewed photos: ", allViewedPhotos);\r\n\r\n    let allPublishedPhotos = await photoRepository.find({ isPublished: true });\r\n    console.log("All published photos: ", allPublishedPhotos);\r\n\r\n    let [allPhotos, photosCount] = await photoRepository.findAndCount();\r\n    console.log("All photos: ", allPublishedPhotos);\r\n    console.log("Photos count: ", allPublishedPhotos);\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n\r\n### æ›´æ–°photo\r\n\r\nç°åœ¨æ¥ä»æ•°æ®åº“ä¸­å–å‡ºä¸€ä¸ªphotoï¼Œä¿®æ”¹å¹¶æ›´æ–°åˆ°æ•°æ®åº“ã€‚\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let photoToUpdate = await photoRepository.findOneById(1);\r\n    photoToUpdate.name = "Me, my friends and polar bears";\r\n    await photoRepository.save(photoToUpdate);\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n\r\nè¿™ä¸ª`id = 1`çš„photoåœ¨æ•°æ®åº“ä¸­å°±æˆåŠŸæ›´æ–°äº†.\r\n\r\n### åˆ é™¤photo\r\n\r\nå†æ¥ï¼Œä»æ•°æ®åº“ä¸­åˆ é™¤æˆ‘ä»¬çš„photo:\r\n\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let photoToRemove = await photoRepository.findOneById(1);\r\n    await photoRepository.remove(photoToRemove);\r\n\r\n}).catch(error => console.log(error));\r\n``` \r\n\r\nè¿™ä¸ª`id = 1`çš„photoå°±åœ¨æ•°æ®åº“ä¸­è¢«ç§»é™¤äº†ã€‚\r\n\r\n### ä¸€å¯¹ä¸€å…³ç³»\r\n\r\næ¥åˆ›å»ºä¸å¦ä¸€ä¸ªç±»çš„ä¸€å¯¹ä¸€å…³ç³»ã€‚\r\næ–°å»ºPhotoMetadata.tsç”¨æ¥å­˜photoçš„å…ƒä¿¡æ¯ã€‚\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn, OneToOne, JoinColumn} from "typeorm";\r\nimport {Photo} from "./Photo";\r\n\r\n@Entity()\r\nexport class PhotoMetadata {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column("int")\r\n    height: number;\r\n\r\n    @Column("int")\r\n    width: number;\r\n\r\n    @Column()\r\n    orientation: string;\r\n\r\n    @Column()\r\n    compressed: boolean;\r\n\r\n    @Column()\r\n    comment: string;\r\n\r\n    @OneToOne(type => Photo)\r\n    @JoinColumn()\r\n    photo: Photo;\r\n}\r\n```\r\n\r\nè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†ä¸€ä¸ªæ–°çš„è£…é¥°å™¨`@OneToOne`ï¼Œå®ƒå¯ä»¥ç”¨æ¥åœ¨ä¸¤ä¸ªå®ä½“ä¹‹é—´åˆ›å»ºä¸€å¯¹ä¸€å…³ç³»ã€‚\r\n`type => Photo`æŒ‡ç¤ºäº†æˆ‘ä»¬æƒ³è¦è¿æ¥çš„å®ä½“ç±»åï¼Œè¿™é‡Œå› ä¸ºTypeScriptè¯­è¨€çš„æ”¯æŒåŸå› ä¸èƒ½ç›´æ¥ç”¨ç±»åã€‚\r\nå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨`() => Photo`ï¼Œä½†æ˜¯`type => Photo`æ˜¾å¾—æ›´æœ‰å¯è¯»æ€§ã€‚\r\nTypeå˜é‡æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•ä¸œè¥¿ã€‚\r\n\r\næˆ‘ä»¬åŒæ ·ä½¿ç”¨äº†`@JoinColumn`è£…é¥°å™¨ï¼Œè¿™ä¸ªè£…é¥°å™¨å¯ä»¥æŒ‡å®šä¸€å¯¹ä¸€å…³ç³»çš„æ‹¥æœ‰è€…ã€‚\r\nå…³ç³»å¯ä»¥æ˜¯å•å‘çš„æˆ–åŒå‘çš„ï¼Œä½†æ˜¯åªæœ‰ä¸€æ–¹æ˜¯æ‹¥æœ‰è€…ï¼ŒåŠ ä¸ªè¿™ä¸ªè£…é¥°å™¨å°±è¡¨ç¤ºå…³ç³»æ˜¯ç»™è¿™ä¸ªè¡¨æœåŠ¡çš„ã€‚\r\n\r\nç°åœ¨è¿è¡Œappï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ªtableï¼Œè¿™ä¸ªtableæœ‰ä¸€ä¸ªè¿æ¥photoçš„å¤–é”®ï¼š\r\n\r\n```shell\r\n+-------------+--------------+----------------------------+\r\n|                      photo `è¯‘è€…æ³¨ï¼šåº”è¯¥æ˜¯PhotoMetadata` |\r\n+-------------+--------------+----------------------------+\r\n| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |\r\n| height      | int(11)      |                            |\r\n| width       | int(11)      |                            |\r\n| comment     | varchar(255) |                            |\r\n| compressed  | boolean      |                            |\r\n| orientation | varchar(255) |                            |\r\n| photo       | int(11)      | FOREIGN KEY                |\r\n+-------------+--------------+----------------------------+\r\n```\r\n\r\n### å­˜ä¸€ä¸ªæœ‰ä¸€å¯¹ä¸€å…³ç³»çš„å¯¹è±¡\r\n\r\nç°åœ¨æ¥åˆ›å»ºä¸€ä¸ªphotoï¼Œä¸€ä¸ªphotoçš„å…ƒä¿¡æ¯ï¼Œå¹¶æŠŠå®ƒä»¬å·²ç»è¿æ¥èµ·æ¥ã€‚\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\nimport {PhotoMetadata} from "./entity/PhotoMetadata";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    // åˆ›å»ºä¸€ä¸ªphoto\r\n    let photo = new Photo();\r\n    photo.name = "Me and Bears";\r\n    photo.description = "I am near polar bears";\r\n    photo.filename = "photo-with-bears.jpg"\r\n    photo.isPublished = true;\r\n\r\n    // åˆ›å»ºä¸€ä¸ªphotoçš„å…ƒä¿¡æ¯\r\n    let  metadata = new PhotoMetadata();\r\n    metadata.height = 640;\r\n    metadata.width = 480;\r\n    metadata.compressed = true;\r\n    metadata.comment = "cybershoot";\r\n    metadata.orientation = "portait";\r\n    metadata.photo = photo; // è¿™é‡ŒæŠŠä¸¤è€…è¿èµ·æ¥\r\n\r\n    // è·å–å®ä½“repositories\r\n    let photoRepository = connection.getRepository(Photo);\r\n    let metadataRepository = connection.getRepository(PhotoMetadata);\r\n\r\n    // å…ˆæ¥æŠŠphotoå­˜åˆ°æ•°æ®åº“\r\n    await photoRepository.save(photo);\r\n\r\n    // photoå­˜å®Œäº†ï¼Œå†å­˜ä¸‹photoçš„å…ƒä¿¡æ¯\r\n    await metadataRepository.save(metadata);\r\n\r\n    // æå®š\r\n    console.log("metadata is saved, and relation between metadata and photo is created in the database too");\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n \r\n### åŒå‘å…³ç³»\r\n\r\nå…³ç³»å¯ä»¥æ˜¯å•å‘çš„æˆ–æ˜¯åŒå‘çš„. \r\nç°åœ¨PhotoMetadataå’ŒPhotoçš„å…³ç³»æ˜¯å•å‘çš„ï¼Œå…³ç³»æ‹¥æœ‰è€…æ˜¯PhotoMetadataï¼ŒPhotoå¹¶ä¸çŸ¥é“PhotoMetadataï¼Œè¿™æ ·å¦‚æœè¦æƒ³ä»Photoé‡Œå¾—åˆ°PhotoMetadataçš„æ•°æ®ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚\r\nç°åœ¨æ¥æ”¹å˜ä¸€ä¸‹ï¼ŒæŠŠå•å‘æ”¹æˆåŒå‘ï¼š\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn, OneToOne, JoinColumn} from "typeorm";\r\nimport {Photo} from "./Photo";\r\n\r\n@Entity()\r\nexport class PhotoMetadata {\r\n\r\n    /* ... å…¶ä»–åˆ— */\r\n\r\n    @OneToOne(type => Photo, photo => photo.metadata)\r\n    @JoinColumn()\r\n    photo: Photo;\r\n}\r\n```   \r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn, OneToOne} from "typeorm";\r\nimport {PhotoMetadata} from "./PhotoMetadata";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    /* ... å…¶ä»–åˆ— */\r\n\r\n    @OneToOne(type => PhotoMetadata, photoMetadata => photoMetadata.photo)\r\n    metadata: PhotoMetadata;\r\n}\r\n```  \r\n\r\n`photo => photo.metadata` æ˜¯ç”¨æ¥æŒ‡å®šåå‘å…³ç³»çš„å­—æ®µåå­—ï¼Œphoto.metadataå°±æŒ‡å‡ºäº†Photoé‡Œçš„metadataå­—æ®µåå­—ã€‚\r\nå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨`@OneToOne(\'metadata\')`æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼Œä¸è¿‡è¿™ç§å¯¹äºä»¥åçš„ä»£ç é‡æ„ä¸å‹å¥½ã€‚\r\n\r\næŒ‰ä¸Šé¢è¯´çš„ï¼Œ`@JoinColumn`åªèƒ½åœ¨å…³ç³»çš„ä¸€è¾¹ä½¿ç”¨æ¥ä½¿è¿™è¾¹åšä¸ºå…³ç³»çš„æ‹¥æœ‰è€…ï¼Œå…³ç³»æ‹¥æœ‰è€…åœ¨æ•°æ®åº“é‡Œçš„è¡¨ç°å°±æ˜¯æ‹¥æœ‰ä¸€ä¸ªå¤–é”®åˆ—ã€‚\r\n\r\n### å–å‡ºå…³ç³»å¯¹è±¡çš„æ•°æ®\r\n\r\nç°åœ¨æ¥ç”¨ä¸€ä¸ªæŸ¥è¯¢æ¥å–å‡ºphotoä»¥åŠå®ƒçš„å…ƒä¿¡æ¯ã€‚\r\næœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç”¨`FindOptions`ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨`QueryBuilder`ã€‚\r\nå…ˆè¯•ä¸‹`FindOptions`ï¼Œé€šè¿‡æŒ‡å®š`FindOptions`æ¥å£ä½œä¸ºå‚æ•°æ¥ä½¿ç”¨`Repository.find`æ–¹æ³•å¯ä»¥å®Œæˆéå¸¸å¤æ‚çš„æŸ¥è¯¢ã€‚\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\nimport {PhotoMetadata} from "./entity/PhotoMetadata";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let photoRepository = connection.getRepository(Photo);\r\n    let photos = await photoRepository.find({\r\n        alias: "photo",\r\n        innerJoinAndSelect: {\r\n            "metadata": "photo.metadata"\r\n        }\r\n    });\r\n\r\n\r\n}).catch(error => console.log(error));\r\n```\r\nè¿”å›çš„photosæ˜¯ä»æ•°æ®åº“é‡Œå–å›çš„photoçš„æ•°ç»„ï¼Œæ¯ä¸ªphotoéƒ½åŒ…å«å®ƒçš„å…ƒä¿¡æ¯ã€‚\r\n\r\n`alias` æ˜¯FindOptionsçš„ä¸€ä¸ªå¿…éœ€é€‰é¡¹ï¼Œè¿™æ˜¯ä½ è‡ªå·±åœ¨selecté‡Œå®šä¹‰çš„åˆ«åï¼Œç„¶åéœ€è¦ç”¨åœ¨æ¥ä¸‹æ¥çš„ where, order by, group by, join ä»¥åŠå…¶ä»–è¡¨è¾¾å¼.\r\n\r\nè¿™é‡Œè¿˜ç”¨åˆ°äº†`innerJoinAndSelect`ï¼Œè¡¨ç¤ºå†…è”æŸ¥è¯¢photo.metadataçš„æ•°æ®ã€‚ \r\n`"photo.metadata"`é‡Œ"photo"æ˜¯ä¸€ä¸ªåˆ«åï¼Œ"metadata"åˆ™æ˜¯ä½ æƒ³æŸ¥è¯¢çš„é‚£ä¸ªå¯¹è±¡çš„å±æ€§åã€‚ \r\n`"metadata"`: æ˜¯å†…è”è¿”å›æ•°æ®çš„æ–°çš„åˆ«å.\r\n\r\nä¸‹é¢æ¥å°è¯•ç¬¬äºŒç§æ–¹å¼ï¼š`QueryBuilder`æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„. ä½¿ç”¨`QueryBuilder`å¯ä»¥ä¼˜é›…å®Œæˆå¤æ‚çš„æŸ¥è¯¢:\r\n\r\n```typescript\r\nimport {createConnection} from "typeorm";\r\nimport {Photo} from "./entity/Photo";\r\nimport {PhotoMetadata} from "./entity/PhotoMetadata";\r\n\r\ncreateConnection(/*...*/).then(async connection => {\r\n\r\n    /*...*/\r\n    let photoRepository = connection.getRepository(Photo);\r\n    let photos = await photoRepository.createQueryBuilder("photo")\r\n            .innerJoinAndSelect("photo.metadata", "metadata")\r\n            .getMany();\r\n\r\n\r\n}).catch(error => console.log(error));\r\n```\r\n\r\n### ä½¿ç”¨ cascade é€‰é¡¹æ¥è‡ªåŠ¨ä¿å­˜å…³ç³»ç€çš„å¯¹è±¡\r\n\r\nä¸Šé¢è¦ä¿å­˜å…³ç³»å¯¹è±¡éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ¥ä¿å­˜ï¼Œç•¥æ˜¾éº»çƒ¦ã€‚\r\nå¦‚æœæˆ‘ä»¬éœ€è¦å½“å…³ç³»å¯¹è±¡ä¸­çš„ä¸€ä¸ªè¢«ä¿å­˜åï¼Œå¦ä¸€ä¸ªä¹ŸåŒæ ·è¢«ä¿å­˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨`cascade`é€‰é¡¹æ¥åšåˆ°ã€‚\r\nç¨å¾®æ”¹ä¸‹`@OneToOne`è£…é¥°:\r\n\r\n```typescript\r\nexport class Photo {\r\n    /// ... å…¶ä»–åˆ—\r\n\r\n    @OneToOne(type => PhotoMetadata, metadata => metadata.photo, {\r\n        cascadeInsert: true,\r\n        cascadeUpdate: true,\r\n        cascadeRemove: true\r\n    })\r\n    metadata: PhotoMetadata;\r\n}\r\n```\r\n\r\n* **cascadeInsert** - å¦‚æœè¡¨ä¸­æ²¡æœ‰å…³ç³»ä¸­çš„metadataï¼Œåˆ™è‡ªåŠ¨insertï¼Œå³æˆ‘ä»¬ä¸éœ€è¦å†æ‰‹åŠ¨insertä¸€ä¸ªæ–°çš„photoMetadataå¯¹è±¡ã€‚\r\n* **cascadeUpdate** - å¦‚æœmetadataæœ‰å˜åŒ–ï¼Œåˆ™è‡ªåŠ¨updateã€‚\r\n* **cascadeRemove** - å¦‚æœæŠŠphotoé‡Œçš„metadataç§»é™¤äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ºç©ºï¼Œåˆ™ä¼šè‡ªåŠ¨removeè¡¨ä¸­çš„è¿™æ¡metadataæ•°æ®ã€‚\r\n\r\nä½¿ç”¨cascadeInsertå°±å¯ä»¥ä¸éœ€è¦åƒä¸Šé¢é‚£è¾¹å…ˆå­˜photoå†å­˜metadataäº†ã€‚\r\nç°åœ¨æˆ‘ä»¬æ¥å•å•å­˜photoå¯¹è±¡ï¼Œç”±äºcascadeçš„ä½œç”¨ï¼Œmetadataä¹Ÿä¼šè‡ªåŠ¨å­˜ä¸Šã€‚\r\n\r\n```typescript\r\ncreateConnection(options).then(async connection => {\r\n\r\n    // åˆ›å»ºphotoå¯¹è±¡\r\n    let photo = new Photo();\r\n    photo.name = "Me and Bears";\r\n    photo.description = "I am near polar bears";\r\n    photo.filename = "photo-with-bears.jpg"\r\n    photo.isPublished = true;\r\n\r\n    // åˆ›å»ºphoto metadata å¯¹è±¡\r\n    let metadata = new PhotoMetadata();\r\n    metadata.height = 640;\r\n    metadata.width = 480;\r\n    metadata.compressed = true;\r\n    metadata.comment = "cybershoot";\r\n    metadata.orientation = "portait";\r\n    \r\n    photo.metadata = metadata; // è¿æ¥èµ·æ¥\r\n\r\n    // å¾—åˆ°repository\r\n    let photoRepository = connection.getRepository(Photo);\r\n\r\n    // å­˜photo\r\n    await photoRepository.save(photo);\r\n    // photo metadataä¹Ÿè‡ªåŠ¨å­˜ä¸Šäº†\r\n    console.log("Photo is saved, photo metadata is saved too.")\r\n\r\n}).catch(error => console.log(error));\r\n```     \r\n\r\n### å¤šå¯¹ä¸€/ä¸€å¯¹å¤šå…³ç³»\r\n\r\næ¥ä¸‹æ¥æ˜¾ç¤ºå¤šå¯¹ä¸€/ä¸€å¯¹å¤šå…³ç³»ã€‚\r\nå‡è®¾ä¸€ä¸ªphotoä¼šæœ‰ä¸€ä¸ªauthorï¼Œå¹¶ä¸”æ¯ä¸ªauthorå¯ä»¥æœ‰å¾ˆå¤šphotoã€‚\r\nå…ˆåˆ›å»ºAuthorå®ä½“ï¼š\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn, OneToMany, JoinColumn} from "typeorm";\r\nimport {Photo} from "./Photo";\r\n\r\n@Entity()\r\nexport class Author {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    name: string;\r\n\r\n    @OneToMany(type => Photo, photo => photo.author) // å¤‡æ³¨ï¼šä¸‹é¢ä¼šä¸ºPhotoåˆ›å»ºauthorå±æ€§\r\n    photos: Photo[];\r\n}\r\n```\r\n\r\nAuthoråŒ…å«ä¸€ä¸ªåå‘çš„å…³ç³»ï¼Œ`OneToMany`æ€»æ˜¯åå‘çš„ï¼Œå¹¶ä¸”æ€»æ˜¯ä¸`ManyToOne`æˆå¯¹å‡ºç°ã€‚\r\n\r\nç°åœ¨æ¥ä¸ºPhotoåŠ ä¸Šå…³ç³»æ‹¥æœ‰è€…ã€‚\r\n\r\n```typescript\r\nimport {Entity, Column, PrimaryGeneratedColumn, ManyToOne} from "typeorm";\r\nimport {PhotoMetadata} from "./PhotoMetadata";\r\nimport {Author} from "./Author";\r\n\r\n@Entity()\r\nexport class Photo {\r\n\r\n    /* ... å…¶ä»–åˆ— */\r\n\r\n    @ManyToOne(type => Author, author => author.photos)\r\n    author: Author;\r\n}\r\n```\r\n\r\nåœ¨`ManyToOne/OneToMany`å…³ç³»ä¸­ï¼Œæ‹¥æœ‰è€…ä¸€è¾¹æ€»æ˜¯`ManyToOne`ã€‚`è¯‘è€…æ³¨ï¼šæ‹¥æœ‰å¤–é”®è€…å³å…³ç³»æ‹¥æœ‰è€…`\r\nä¹Ÿå°±æ˜¯`ManyToOne`çš„é‚£ä¸ªå­—æ®µå­˜çš„æ˜¯å¦ä¸€ä¸ªå¯¹è±¡çš„idã€‚`è¯‘è€…æ³¨ï¼šä¹Ÿå°±æ˜¯ä¸Šé¢çš„authorè™½ç„¶å±æ€§æ˜¯Authorï¼Œä½†åœ¨æ•°æ®åº“ä¸­ç±»å‹æ˜¯Author idçš„ç±»å‹ï¼Œå­˜çš„ä¹Ÿæ˜¯id`\r\n\r\næ‰§è¡Œä¸Šé¢çš„ä»£ç å°†ä¼šè‡ªåŠ¨åˆ›å»ºauthorè¡¨ï¼Œå¦‚ä¸‹:\r\n\r\n\r\n```shell\r\n+-------------+--------------+----------------------------+\r\n|                          author                         |\r\n+-------------+--------------+----------------------------+\r\n| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |\r\n| name        | varchar(255) |                            |\r\n+-------------+--------------+----------------------------+\r\n```\r\n\r\nå› ä¸ºphotoè¡¨å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥ä¸æ˜¯å¢åŠ è€Œæ˜¯ä¿®æ”¹photoè¡¨ - æ·»åŠ ä¸€ä¸ªæ–°å¤–é”®åˆ—author:\r\n\r\n```shell\r\n+-------------+--------------+----------------------------+\r\n|                         photo                           |\r\n+-------------+--------------+----------------------------+\r\n| id          | int(11)      | PRIMARY KEY AUTO_INCREMENT |\r\n| name        | varchar(255) |                            |\r\n| description | varchar(255) |                            |\r\n| filename    | varchar(255) |                            |\r\n| isPublished | boolean      |                            |\r\n| author      | int(11)      | FOREIGN KEY                |\r\n+-------------+--------------+----------------------------+\r\n```\r\n   \r\n### å¤šå¯¹å¤šå…³ç³»\r\n\r\nå‡è®¾photoå¯ä»¥å­˜åœ¨å¤šä¸ªç›¸å†Œä¸­ï¼Œå¹¶ä¸”ç›¸å†Œé‡Œå¯ä»¥åŒ…å«å¤šä¸ªphotoã€‚\r\nå…ˆåˆ›å»ºä¸€ä¸ª`Album`ç±» \r\n\r\n```typescript\r\nimport {Entity, PrimaryGeneratedColumn, Column, ManyToMany, JoinTable} from "typeorm";\r\n\r\n@Entity()\r\nexport class Album {\r\n\r\n    @PrimaryGeneratedColumn()\r\n    id: number;\r\n\r\n    @Column()\r\n    name: string;\r\n\r\n    @ManyToMany(type => Photo, photo => photo.albums, {  // å¤‡æ³¨: ä¼šåœ¨ä¸‹é¢çš„Photoç±»é‡Œæ·»åŠ "albums"å±æ€§\r\n        cascadeInsert: true, // åœ¨æ·»åŠ Albumæ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ç›¸å†Œé‡Œçš„Photo\r\n        cascadeUpdate: true, // åœ¨æ›´æ–°Albumæ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–°ç›¸å†Œé‡Œçš„Photo \r\n        cascadeRemove: true  // åœ¨ç§»é™¤Albumæ—¶ï¼Œä¼šè‡ªåŠ¨ç§»é™¤ç›¸å†Œé‡Œçš„Photo\r\n    })\r\n    @JoinTable()\r\n    photos: Photo[];\r\n}\r\n```\r\n  \r\n`@JoinTable`å¤šå¯¹å¤šå…³ç³»æ‹¥æœ‰è€…å¿…é¡»æŒ‡å®šçš„ã€‚\r\n\r\næ¥ç€ç»™`Photo`å®ä½“åŠ ä¸ªåå‘å…³ç³»:\r\n\r\n```typescript\r\nexport class Photo {\r\n    /// ... å…¶ä»–åˆ—\r\n\r\n    @ManyToMany(type => Album, album => album.photos, {\r\n        cascadeInsert: true, // åœ¨æ·»åŠ Albumæ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ç›¸å†Œé‡Œçš„Photo\r\n        cascadeUpdate: true, // åœ¨æ›´æ–°Albumæ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–°ç›¸å†Œé‡Œçš„Photo \r\n        cascadeRemove: true  // åœ¨ç§»é™¤Albumæ—¶ï¼Œä¼šè‡ªåŠ¨ç§»é™¤ç›¸å†Œé‡Œçš„Photo\r\n    })\r\n    albums: Album[];\r\n}\r\n```\r\n\r\næ‰§è¡Œä¸Šé¢çš„ä»£ç åä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå« **album_photos_photo_albums**çš„*è”æ¥è¡¨*:\r\n\r\n```shell\r\n+-------------+--------------+----------------------------+\r\n|                album_photos_photo_albums                |\r\n+-------------+--------------+----------------------------+\r\n| album_id_1  | int(11)      | PRIMARY KEY FOREIGN KEY    |\r\n| photo_id_2  | int(11)      | PRIMARY KEY FOREIGN KEY    |\r\n+-------------+--------------+----------------------------+\r\n```\r\n\r\nè®°å¾—æŠŠ`Album`å®ä½“åŠ åˆ°ConnectionOptionsä¸­:\r\n\r\n```typescript\r\nconst options: CreateConnectionOptions = {\r\n    // ... å…¶ä»–é…ç½®\r\n    entities: [Photo, PhotoMetadata, Author, Album]\r\n};\r\n```\r\n\r\nç°åœ¨æ¥å¾€æ•°æ®åº“é‡Œæ’å…¥albumså’Œphotos        \r\n\r\n```typescript\r\nlet connection = await createConnection(options);\r\n\r\n// åˆ›å»ºä¸¤ä¸ªalbums\r\nlet album1 = new Album();\r\nalbum1.name = "Bears";\r\n\r\nlet album2 = new Album();\r\nalbum2.name = "Me";\r\n\r\n// åˆ›å»ºä¸¤ä¸ªphotos\r\nlet photo1 = new Photo();\r\nphoto1.name = "Me and Bears";\r\nphoto1.description = "I am near polar bears";\r\nphoto1.filename = "photo-with-bears.jpg";\r\nphoto1.albums = [album1];\r\n\r\nlet photo2 = new Photo();\r\nphoto2.name = "Me and Bears";\r\nphoto2.description = "I am near polar bears";\r\nphoto2.filename = "photo-with-bears.jpg";\r\nphoto2.albums = [album2];\r\n\r\n// è·å–Photoçš„repository\r\nlet photoRepository = connection.getRepository(Photo);\r\n\r\n// ä¾æ¬¡å­˜å‚¨photosï¼Œç”±äºcascadeï¼Œalbumsä¹ŸåŒæ ·ä¼šè‡ªåŠ¨å­˜èµ·æ¥\r\nawait photoRepository.save(photo1);\r\nawait photoRepository.save(photo2);\r\n\r\nconsole.log("Both photos have been saved");\r\n```\r\n\r\n### ä½¿ç”¨QueryBuilder\r\n\r\nå¯ä»¥åˆ©ç”¨QueryBuilderæ¥æ„å»ºä¸€ä¸ªéå¸¸å¤æ‚çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š\r\n\r\n```typescript\r\nlet photoRepository = connection.getRepository(Photo);\r\nlet photos = await photoRepository\r\n    .createQueryBuilder("photo") // åˆ«åï¼Œå¿…å¡«é¡¹ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡æŸ¥è¯¢\r\n    .innerJoinAndSelect("photo.metadata", "metadata")\r\n    .leftJoinAndSelect("photo.albums", "albums")\r\n    .where("photo.isPublished=true")\r\n    .andWhere("(photo.name=:photoName OR photo.name=:bearName)")\r\n    .orderBy("photo.id", "DESC")\r\n    .skip(5)\r\n    .take(10)\r\n    .setParameters({ photoName: "My", bearName: "Mishka" })\r\n    .getMany();\r\n```\r\n\r\nè¿™ä¸ªæŸ¥è¯¢ä¼šæŸ¥æ‰¾å·²ç»publishedçš„ï¼Œå¹¶ä¸”nameæ˜¯"My"æˆ–"Mishka"ï¼Œ\r\nå¾—åˆ°çš„ç»“æœä¼šä»ç¬¬5ä¸ªå¼€å§‹ï¼ˆåˆ†é¡µåç§»å†³å®šçš„ï¼‰ï¼Œ\r\nå¹¶ä¸”åªä¼šå¾—åˆ°10ä¸ªç»“æœï¼ˆåˆ†é¡µæ¯é¡µä¸ªæ•°å†³å®šçš„ï¼‰ï¼Œ\r\næ‰€å¾—ç»“æœæ˜¯ä»¥idçš„å€’åºæ’åºçš„ï¼Œ\r\nPhotoçš„albumsæ˜¯å·¦è”æ¥ï¼Œphotoçš„metadataæ˜¯å†…è”æ¥ã€‚\r\n\r\nä½ å°†åœ¨åº”ç”¨ç¨‹åºä¸­å¤§é‡ä½¿ç”¨QueryBuilderã€‚\r\näº†è§£æ›´å¤šQueryBuilder[è¿™é‡Œ](./docs/select-query-builder.md).\r\n\r\n## æ ·ä¾‹\r\n\r\nçœ‹çœ‹[æ ·ä¾‹](https://github.com/typeorm/typeorm/tree/master/sample)é‡Œè¿™äº›ä¾‹å­çš„ç”¨æ³•\r\n\r\nè¿™äº›ä»“åº“ï¼Œä½ å¯ä»¥å…‹éš†ä¸‹æ¥å¸®åŠ©ä½ å¼€å§‹:\r\n\r\n* [Example how to use TypeORM with TypeScript](https://github.com/typeorm/typescript-example)\r\n* [Example how to use TypeORM with JavaScript](https://github.com/typeorm/javascript-example)\r\n* [Example how to use TypeORM with JavaScript and Babel](https://github.com/typeorm/babel-example)\r\n* [Example how to use TypeORM with TypeScript and SystemJS in Browser](https://github.com/typeorm/browser-example)\r\n* [Example how to use Express and TypeORM](https://github.com/typeorm/typescript-express-example)\r\n* [Example how to use Koa and TypeORM](https://github.com/typeorm/typescript-koa-example)\r\n* [Example how to use TypeORM with MongoDB](https://github.com/typeorm/typeorm-typescript-mongo-example)\r\n* [Example how to use TypeORM in a Cordova/PhoneGap app](https://github.com/typeorm/cordova-example)\r\n* [Example how to use TypeORM with an Ionic app](https://github.com/typeorm/ionic-example)\r\n\r\n## æ‰©å±•\r\n\r\nè¿™å‡ ä¸ªæ‰©å±•å¯ä»¥ç®€åŒ–TypeORMçš„ä½¿ç”¨ï¼Œå¹¶å°†å…¶ä¸å…¶ä»–æ¨¡å—é›†æˆï¼š\r\n\r\n* [TypeORM integration](https://github.com/typeorm/typeorm-typedi-extensions) with [TypeDI](https://github.com/pleerock/typedi)\r\n* [TypeORM integration](https://github.com/typeorm/typeorm-routing-controllers-extensions) with [routing-controllers](https://github.com/pleerock/routing-controllers)\r\n* Models generation from existing database - [typeorm-model-generator](https://github.com/Kononnable/typeorm-model-generator)',title:"TypeORM - æœ€å¥½çš„Node.js ORMæ¡†æ¶",last_reply_at:"2018-04-03T02:23:56.050Z",good:!1,top:!1,reply_count:13,visit_count:565,create_at:"2018-04-01",author:{loginname:"huanz",avatar_url:"https://avatars1.githubusercontent.com/u/5865669?v=4&s=120"}},{id:"5ac2e48c0ab0448f0fe3f81e",author_id:"4efc278525fa69ac69000141",tab:"share",content:"æ´»åŠ¨é“¾æ¥: http://react-china.org/t/topic/19934/4\r\næ´»åŠ¨æ—¶é—´: å¤§æ¦‚æŒç»­ä¸€å¤©å¤š, åˆ°å‘¨ä¸‰æ™šä¸Š\r\nè§„åˆ™: æœ‰ä»€ä¹ˆé—®é¢˜æƒ³è·Ÿå·¥ä¸šèšæé—®å•Š, ç‰¹åˆ«æ˜¯ React, æ¬¢è¿æ¥äº’åŠ¨~",title:"React ä¸­æ–‡è®ºå›, å·¥ä¸šèšçš„ AMA, æ¬¢è¿å‚åŠ ",last_reply_at:"2018-04-03T02:18:52.633Z",good:!1,top:!1,reply_count:0,visit_count:40,create_at:"2018-04-03",author:{loginname:"jiyinyiyong",avatar_url:"https://avatars0.githubusercontent.com/u/449224?v=4&s=120"}},{id:"5ac2282296f344940fbbac7f",author_id:"5a6ebfaa9288dc8153288322",tab:"share",content:"- æ–‡ä»¶æµå¯¼å‡ºexcel\r\n> é‡ç‚¹ï¼šContent-Disposition æ–‡ä»¶åè¦ä¸­æ–‡æ˜¾ç¤º\r\nå‚è€ƒ[https://blog.csdn.net/liuyaqi1993/article/details/78275396][1]\r\n\r\n```javascript\r\nconst nodeExcel = require('node-xlsx');\r\nconst urlencode = require('urlencode');\r\n\r\nfunction exportList(ctx, config, listData, excelName) {\r\n    let excelConfig = [];\r\n    excelConfig.push(config.map(item => {\r\n      return item.title\r\n    }))\r\n\r\n    listData.forEach(list => {\r\n      excelConfig.push(config.map(item => {\r\n        const value = list[item.name];\r\n        // ä¸ä¸€å®šè¦æœ‰valueï¼Œ å› ä¸ºå¯èƒ½æ˜¯è‡ªç”±ç»„åˆçš„value\r\n        return item.format && item.format(value, list) || value;\r\n      }))\r\n    })\r\n\r\n    let buffer = nodeExcel.build([{name: excelName, data: excelConfig}]);\r\n    ctx.set('Content-Type', 'application/octet-stream');\r\n     // ctx.request.headers['user-agent']\r\n    let name = urlencode(excelName + '_' + (+new Date()) + '.xlsx', \"utf-8\");\r\n    ctx.set(\"Content-Disposition\", \"attachment; filename* = UTF-8''\"+name);    \r\n    // ctx.set(\"Content-Disposition\", \"attachment; filename=\"+ (+new Date()) + '.xlsx');\r\n    ctx.body = buffer;\r\n}\r\n\r\nmodule.exports = {\r\n  exportList: exportList\r\n}\r\n```\r\n\r\n```javascript\r\n// config æ ¼å¼\r\nconst config = [{\r\n      name: 'userid',\r\n      title: 'ç”¨æˆ·ID',\r\n    },{\r\n      name: 'up_time',\r\n      title: 'çŠ¶æ€æ—¶é—´',\r\n      format: function(value) {\r\n        return value.replace(/\\.\\d+/, '');\r\n      }\r\n    },{\r\n      name: 'appl_status_byhand',\r\n      // name: 'appl_status_byhand_desc',\r\n      title: 'äººå®¡çŠ¶æ€',\r\n      format: function(value) {\r\n        return value && manualStatus[value] &&  manualStatus[value].text || '-'\r\n      }\r\n    },{\r\n      name: 'available_quota/credit_quota',\r\n      title: 'å‰©ä½™é¢åº¦/æˆä¿¡é¢åº¦',\r\n      format: function(value, item) {\r\n        return `Â¥${item.available_quota/100 || 0}/Â¥${item.credit_quota/100 || 0}`\r\n      }\r\n    },{\r\n      name: 'user_type_desc',\r\n      title: 'åå•ç±»å‹',\r\n      format: function(value, item) {\r\n        if(item.user_type) {\r\n          item.user_type.forEach(user => {\r\n            userTypeText.push(user_type_define[user] || '-');\r\n          });\r\n          return userTypeText.join('|');\r\n        } else {\r\n          return '';\r\n        }\r\n      }\r\n    }]\r\n```\r\n\r\n [1]: https://blog.csdn.net/liuyaqi1993/article/details/78275396",title:"æ–‡ä»¶æµå¯¼å‡ºexcelä¸”æ˜¾ç¤ºä¸­æ–‡æ–‡ä»¶å",last_reply_at:"2018-04-03T02:18:10.619Z",good:!1,top:!1,reply_count:3,visit_count:118,create_at:"2018-04-02",author:{loginname:"dmodaii",avatar_url:"https://avatars1.githubusercontent.com/u/16190100?v=4&s=120"}},{id:"5ac2e4090ab0448f0fe3f81d",author_id:"591d587bd371b6372a8afb3f",tab:"ask",content:"æœ‰äººçŸ¥é“@typesè¿™ä¸ªåŒ…å—ï¼Œç»å¸¸çœ‹åˆ°æœ‰å¼•ç”¨åˆ°è¿™é‡Œçš„åŒ…ï¼Œè€Œä¸”æˆ‘ç”¨çš„æœ¬åœ°ï¼®ï¼°ï¼­æœåŠ¡å™¨è¿˜ç»å¸¸ä»£ç†ä¸äº†è¿™äº›åŒ…ï¼Œå¾ˆå¤´ç—›ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œå•Šï¼",title:"npmåŒ…ï¼ types",last_reply_at:"2018-04-03T02:16:41.700Z",good:!1,top:!1,reply_count:0,visit_count:41,create_at:"2018-04-03",author:{loginname:"ugrg",avatar_url:"https://avatars2.githubusercontent.com/u/38195?v=4&s=120"}},{id:"5ab3c02b28441024b73f5c28",author_id:"5a73b540ce45d440451465fe",tab:"ask",content:"flarumå‡çº§å®åœ¨æ˜¯å¤ªç¼“æ…¢ï¼Œä½†ç¡®å®æ¼‚äº®çš„ä¸€å¡Œç³Šæ¶‚ï¼Œè¶…èµã€‚\r\næˆ‘ä¸ªäººè®¤ä¸ºflarumçš„åç«¯ç”¨phpæ˜¯ä¸€ä¸ªè´¥ç¬”ï¼Œphpå’Œflarumçš„ä¼˜é›…ä¼¼ä¹å®Œå…¨ä¸æ²¾è¾¹ã€‚\r\næ‰€ä»¥å¦‚æœä»…ä»…è€ƒè™‘ä¸€ä¸ªè®ºå›æœ¬èº«çš„åŠŸèƒ½çš„è¯ï¼Œå¹²è„†æŠŠcnodeçš„å‰ç«¯é¡µé¢æ”¹æˆflarumé£æ ¼ï¼Œä¼šä¸ä¼šæ›´å—æ¬¢è¿ï¼Ÿ\r\nä»¥ä¸Šæ˜¯è‡†æƒ³ï¼Œå¦‚æœ‰ä¸åˆé€‚è¯·æŒ‡æ­£ã€‚",title:"æœ‰æ²¡æœ‰å¯èƒ½æŠŠcnodeçš„å‰ç«¯é¡µé¢ä»¿æˆflarumé‚£ç§ï¼Ÿ",last_reply_at:"2018-04-03T01:45:36.101Z",good:!1,top:!1,reply_count:11,visit_count:587,create_at:"2018-03-22",author:{loginname:"YuanChenmang",avatar_url:"https://avatars2.githubusercontent.com/u/23253929?v=4&s=120"}},{id:"5ac2085c0ab0448f0fe3f7f0",author_id:"596a2b5edb0b6aec18a28569",tab:"share",content:"#### **èµ·å› **\r\næœ€è¿‘åœ¨Cnodeç¤¾åŒºçœ‹åˆ°ç¤¾åŒºå¤§ä½¬ä»¬é‡æ„ä»£ç ç”¨äº†æ–°çš„æŠ€æœ¯æ ˆï¼Œç°æ­£åœ¨å…¬æµ‹é˜¶æ®µã€‚å› ä¸ºæ­£å¥½æ“…é•¿ç”¨Node.JSæ¥å¼€å‘è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ä¸ºäº†å¯¹ç¤¾åŒºåšç‚¹è´¡çŒ®ï¼Œæ‹‰äº†å‡ ä¸ªæŠ€æœ¯å¥½å‹ï¼Œè®¡åˆ’åˆ©ç”¨å‘¨æœ«æ—¶é—´å¸®ç¤¾åŒºå†™äº›UIè‡ªåŠ¨åŒ–ä»£ç ã€‚è¿™ä¸€å»ºè®®å¾—åˆ°äº†CNodeJSçš„ç‹¼å”çš„å¤§åŠ›æ”¯æŒï¼Œè¿™ä¸€å»ºè®®çš„å¸–å­ç½®é¡¶åï¼Œåˆæœ‰å¥½å¤šçƒ­å¿ƒçš„æœ‹å‹åŠ å…¥äº†è¿›æ¥ï¼Œæœ‰æ“…é•¿è‡ªåŠ¨åŒ–å¼€å‘çš„ã€ä¹Ÿæœ‰æ“…é•¿æ‰‹åŠ¨æµ‹è¯•çš„åŒå­¦ã€‚  \r\n\r\n#### **è®¡åˆ’**\r\n- **æ—¶é—´**ï¼šå‡†å¤‡æ˜ŸæœŸæ—¥(03-25)ç”¨ä¸€å¤©æ—¶é—´è¿›è¡Œã€‚\r\n- **åœ°ç‚¹**ï¼šå››å·åŒ—è·¯ä¹æµ¦è·¯çš„ä¸€é—´åˆ›ä¸šå·¥åŠ\r\n- **ç›®æ ‡**ï¼šåŸºäºNode.jså¼€å‘CNodeç¤¾åŒºçš„UIè‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ã€‚\r\n- **ä½¿ç”¨æŠ€æœ¯**ï¼šå½“ç„¶è¦ç”¨Node.JS. ä¸»è¦ç”¨Nodejs + [Cucumber](https://github.com/cucumber/cucumber-js) + Selenium\r\n- **å¼€å‘ç¯å¢ƒ**ï¼šWindows ç³»ç»Ÿä½¿ç”¨ [CukeTest](http://cuketest.com/) è¿›è¡Œå¼€å‘ã€‚Mac ç³»ç»Ÿä½¿ç”¨ VSCode è¿›è¡Œå¼€å‘\r\n\r\nè¿«ä¸æ€¥å¾…çš„å°æœ‹å‹å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹æˆæœï¼Œç»è¿‡ä¸€æ•´å¤©çš„åŠªåŠ›ï¼ŒCNodeJSçš„å„é¡¹ä¸»è¦ç•Œé¢æµ‹è¯•éƒ½å®ç°äº†ï¼Œä¸å…‰æœ‰ä»£ç ï¼Œè€Œä¸”æœ‰è‡ªç„¶è¯­è¨€æè¿°çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æ‰€æœ‰äººéƒ½èƒ½çœ‹å¾—æ‡‚ï¼š\r\n![post_topic.gif](//dn-cnode.qbox.me/Ft8epShi4qfNLoes7jAe9nfYK20q)\r\n\r\næ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä»£ç å’Œæµ‹è¯•ç”¨ä¾‹éƒ½æ”¾åœ¨githubä¸Šï¼Œç½‘å€åœ¨ï¼š\r\n[https://github.com/CnodejsTest/UIAutoTest](https://github.com/CnodejsTest/UIAutoTest)\r\n\r\næ„Ÿå…´è¶£çš„åªè¦æ‹‰ä¸‹æ¥ï¼ŒæŒ‰ç…§æè¿°çš„æ­¥éª¤å°±å¯ä»¥è¿è¡Œäº†ã€‚  \r\n\r\n#### **æ˜ŸæœŸæ—¥**\r\næ˜¯æˆ‘ä»¬è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¼€å‘æ—¥ã€‚ä¸Šåˆ10ç‚¹ä¹æµ¦è·¯480å·ï¼ŒåŒå­¦ä»¬éƒ½åˆ°é½äº†ã€‚æœ‰ä¸€äº›æ‰‹å·¥æµ‹è¯•çš„åŒå­¦ï¼Œä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•çš„åŒå­¦ã€‚æŒ‰ç…§è®¡åˆ’æœ¬æ¬¡å‚ä¸æ´»åŠ¨çš„åŒå­¦æœ‰8åå°ä¼™ä¼´å…¬å¸åšæ‰‹å·¥æµ‹è¯•ï¼Œ4åå°ä¼™ä¼´åšè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ä»–ä»¬å½“ä¸­æœ‰äº›çŸ¥é“è¡Œä¸ºé©±åŠ¨æµ‹è¯•ï¼Œæœ‰äº›è¿˜ä¸çŸ¥é“è¿™äº›æ¦‚å¿µã€‚\r\n\r\nä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿå¾ˆå¿«çš„èå…¥åˆ°ä¸€èµ·æ•æ·å¼€å‘ï¼Œ2åæ‰‹å·¥æµ‹è¯•å°ä¼™ä¼´ä¸1åè‡ªåŠ¨åŒ–æµ‹è¯•å°ä¼™ä¼´1ç»„ï¼Œæ‰‹å·¥æµ‹è¯•çš„å°ä¼™ä¼´å†™æµ‹è¯•ç”¨ä¾‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å°ä¼™ä¼´å†™UIè‡ªåŠ¨åŒ–è„šæœ¬ã€‚ä½ç½®å®‰æ’æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•å°ä¼™ä¼´ååœ¨ä¸­ï¼Œæ‰‹å·¥æµ‹è¯•å°ä¼™ä¼´ååœ¨ä¸¤è¾¹ï¼Œè¿™æ ·æ›´æ˜“äºä»–ä»¬æ²Ÿé€šå’Œå­¦ä¹ ã€‚\r\n![QQå›¾ç‰‡20180402180809.jpg](//dn-cnode.qbox.me/Fp7V6REPuxpmKBwTFtIJBDTqYYSr)\r\n\r\n##### **ä¸Šåˆ**\r\nä¸Šåˆä¸»è¦æ˜¯â€œç»Ÿä¸€æ€æƒ³ï¼Œæé«˜è®¤è¯†â€ï¼Œä¸ºäº†è®©æ‰€æœ‰äººéƒ½äº†è§£å¼€å‘çš„æŠ€æœ¯å’Œæ–¹æ³•ã€‚æˆ‘ä»¬ä¸»è¦ä½¿ç”¨CukeTestå®¢æˆ·ç«¯æ¥é˜é‡Šä¸‹è¡Œä¸ºé©±åŠ¨æµ‹è¯•çš„æ¦‚å¿µã€‚æˆ‘ä»¬æ‹¿CNodeJSç¤¾åŒºçš„â€œç™»å½•â€åœºæ™¯ä¸ºä¾‹ï¼Œä½œä¸ºæ‰€æœ‰äººçš„çƒ­èº«ç»ƒä¹ ã€‚  \r\n\r\nå¼€å‘çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šå…ˆåœ¨CukeTestä¸Šå†™æµ‹è¯•ç”¨ä¾‹ã€‚ç”¨ä¾‹ä¹Ÿå†™çš„å·®ä¸å¤šçš„æ—¶å€™å¯ä»¥åœ¨CukeTestä¸­ä¸€é”®ç”Ÿæˆè‡ªåŠ¨åŒ–ä»£ç æ¡†æ¶ã€‚ç„¶åå®ç°è¿™ä¸ªæ¡†æ¶ã€‚è¾¹å¡«å……ä»£ç ï¼Œè¾¹åœ¨é¡µé¢ä¸Šå®šä½å…ƒç´ ã€‚å°†å…ƒç´ å®šä½çš„ä¿¡æ¯å¡«å……åˆ°ä»£ç ä¸­ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒSeleniumå®šä½ä¿¡æ¯å¯ä»¥é€‰ID, CSS, XPathç­‰ã€‚å½“å®ç°å®Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å°±å¯ç‚¹å‡»è¿è¡Œã€‚ç»è¿‡éªŒè¯èƒ½å¤Ÿæ­£å¸¸ç™»é™†ã€‚\r\n\r\næœ‰äº›æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•çš„å°æœ‹å‹ä»æ¥æ²¡åšè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¼€å‘ï¼Œä½†è·Ÿç€è‡ªåŠ¨åŒ–æµ‹è¯•è€å¸æœºä»¬ï¼Œä¹Ÿæ²¡è¿‡å¤šä¹…å°±å†™å‡ºæ¥äº†ã€‚è€Œä¸”èƒ½å¤ŸæˆåŠŸè¿è¡Œï¼Œç™»é™†åˆ°æµ‹è¯•çš„ç¯å¢ƒæ­å»ºçš„CNodeJSç¤¾åŒºã€‚æœ‰äº›ä¸ç”±çš„æ„Ÿå¹è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿå¯ä»¥è¿™ä¹ˆç®€å•ã€‚æ•ˆæœå¦‚ä¸‹ï¼š\r\n![login.gif](//dn-cnode.qbox.me/FlUtA119-DW2fEUrmFOisNWQU93J)\r\n\r\nå½“è¿™ä¸ªåœºæ™¯å®Œæˆåï¼Œé€šè¿‡CukeTestä¸€é”®è½¬æ¢æˆâ€œåœºæ™¯â€å¤§çº²å°±å¯æ·»åŠ æ›´å¤šçš„æµ‹è¯•æ•°æ®äº†ã€‚\r\nä¸å…‰æœ‰æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼Œè€Œä¸”å¯ä»¥éªŒè¯é”™è¯¯ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚è¿™æ ·ä¸€ä¸ªæµ‹è¯•åœºæ™¯å°±å˜æˆäº†nä¸ª:\r\n![æ— æ ‡é¢˜.png](//dn-cnode.qbox.me/FhAfo8rm5CAGoHsFjm7_F90mlN-e)\r\nä¸Šåˆä¸»è¦å°±æ˜¯å¼€å‘ç™»é™†åœºæ™¯ã€‚ç”±äºå¤§å®¶éƒ½æ˜¯ä¸´æ—¶è¿‡æ¥ï¼Œåˆšå¼€å§‹è¿˜æ˜¯ä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œç»è¿‡å‡ è½®çš„åä½œï¼Œå¤§å®¶æ…¢æ…¢ç†Ÿæ‚‰äº†å¼€å‘æµç¨‹ã€‚  \r\n\r\n##### **ä¸‹åˆ**\r\nä¸­åˆåƒè¿‡é¥­ï¼Œä¸ºæé«˜æ•ˆç‡ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å°ä¼™ä¼´å°±å•ç‹¬å‡ºæ¥å»å†™UIè‡ªåŠ¨åŒ–ä»£ç ã€‚åŠŸèƒ½æµ‹è¯•å°ä¼™ä¼´å»å­¦ä¹ ä¸€äº›åŸºæœ¬çš„selenium-webdriver çŸ¥è¯†ï¼Œä»–ä»¬é€šè¿‡ä½¿ç”¨CukeTestç”Ÿæˆçš„è‡ªåŠ¨åŒ–ä»£ç ï¼Œæ¨¡ä»¿ä¹‹å‰çš„ä»£ç èƒ½å¤Ÿå¾ˆå¿«é€Ÿçš„å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œå¤§å®¶éƒ½å¾ˆå¼€å¿ƒã€‚\r\n![QQå›¾ç‰‡20180402180816.jpg](//dn-cnode.qbox.me/Fi67rWYhceKoLxeh4d1ZXgErEDkh)\r\nè‡ªåŠ¨åŒ–åŒå­¦ç›¸ç»§å¼€å‘å‡ºæ¥æµ‹è¯•è„šæœ¬ï¼Œæ‰€ä»¥æ™šäº›æ—¶å€™ï¼Œä¸»è¦è°ƒè¯•è‡ªåŠ¨åŒ–åŒå­¦å¼€å‘çš„è„šæœ¬ï¼Œå¹¶ä¸”å¯¹åœºæ™¯è¿›è¡Œæ·»åŠ æ ¡éªŒç‚¹ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å®ç°äº†ç¤¾åŒºçš„ç”¨æˆ·æ³¨å†Œï¼Œç”¨æˆ·ç™»å½•ï¼Œå‘å¸ƒè¯é¢˜ï¼Œåˆ é™¤è¯é¢˜ï¼Œæ”¶è—è¯é¢˜ï¼Œå›å¤è¯é¢˜çš„UIè‡ªåŠ¨åŒ–ã€‚ä¿®æ”¹å®Œæˆçš„è„šæœ¬ä¸Šä¼ åˆ°GitHubä»£ç åº“ã€‚  \r\n\r\n**æ€»ç»“ï¼š**\r\né€šè¿‡è¿™æ¬¡æ²™é¾™ï¼Œå¤§å®¶åœ¨ä¸€èµ·åè°ƒçš„ä¹Ÿéå¸¸å¥½ï¼Œå¤§å®¶ä¹Ÿä¸€èµ·å¢é•¿äº†æµ‹è¯•ç»éªŒï¼ŒåŒæ—¶ï¼Œä¹Ÿè®¤è¯†äº†æ–°çš„æœ‹å‹ã€‚æ›´é‡è¦æ˜¯ï¼Œæˆ‘ä»¬çš„è‡ªåŠ¨åŒ–ä»£ç å°†ä¼šè´¡çŒ®ç»™Cnodeç¤¾åŒºï¼Œé€ ç¦å¤§å®¶ã€‚è¿™é‡Œè¦æ„Ÿè°¢Cnodeç¤¾åŒºï¼Œæä¾›ä¸€ä¸ªè¿™æ ·çš„å¹³å°ï¼Œå¹¶ä¸”é¼“åŠ±æˆ‘ä»¬ã€‚\r\nåŒæ—¶æ„Ÿè°¢CukeTestï¼Œæä¾›å·¥å…·èƒ½è®©æˆ‘ä»¬å¾ˆå¿«çš„ååŠ©å¼€å‘ã€‚ä¹Ÿæ„Ÿè°¢çŒ«å”ï¼Œç»™æˆ‘ä»¬æä¾›åœºåœ°ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿååœ¨ä¸€èµ·äº¤æµã€‚\r\n![QQå›¾ç‰‡20180402180822.jpg](//dn-cnode.qbox.me/Fv1tEGdM2ypy9hIkJwtKTWyDw7w_)",title:"Node.JSè‡ªåŠ¨åŒ–æµ‹è¯•åœ¨CNodeç¤¾åŒºä¸­çš„åº”ç”¨  -- CnodeJSçº¿ä¸‹æ²™é¾™æ´»åŠ¨",last_reply_at:"2018-04-03T01:19:25.463Z",good:!0,top:!1,reply_count:12,visit_count:300,create_at:"2018-04-02",author:{loginname:"imzengyang",avatar_url:"https://avatars1.githubusercontent.com/u/22312483?v=4&s=120"}}],tab:"",loading:!1,pageInfo:{page:1,total:1e3}},user:{loginInfo:{},userInfo:{},messages:{has_read_messages:[],hasnot_read_messages:[]},accesstoken:"",loading:!1}},serverRendered:!0}</script><script defer src="/nuxt-blog/_nuxt/manifest.99e36d02ae9d35f9a67a.js"></script><script defer src="/nuxt-blog/_nuxt/layouts_default.3e9b7a2d9551da30542e.js"></script><script defer src="/nuxt-blog/_nuxt/pages_index.1a1dabc786aba819b9a7.js"></script><script defer src="/nuxt-blog/_nuxt/vendor.99e36d02ae9d.js"></script><script defer src="/nuxt-blog/_nuxt/hare.3ad678fdff0b.js"></script>
  

